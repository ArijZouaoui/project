{"ast":null,"code":"/*!\nFullCalendar Resources Common Plugin v4.4.0\nDocs & License: https://fullcalendar.io/scheduler\n(c) 2019 Adam Shaw\n*/\nimport { memoize, filterHash, rangesIntersect, memoizeOutput, isPropsEqual, mapHash, combineEventUis, refineProps, rangesEqual, processScopedUiProps, parseBusinessHours, EventApi, Calendar, Splitter, mergeEventStores, isPropsValid, appendToElement, htmlEscape, cssToStr, config, isValidDate, addDays, unpromisify, requestJson, htmlToElement, createFormatter, computeFallbackHeaderFormat, removeElement, renderDateCell, findElements, Component, flexibleCompare, compareByFieldSpecs, createPlugin } from '@fullcalendar/core';\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\n\n/* global Reflect, Promise */\n\nvar extendStatics = function (d, b) {\n  extendStatics = Object.setPrototypeOf || {\n    __proto__: []\n  } instanceof Array && function (d, b) {\n    d.__proto__ = b;\n  } || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n  };\n\n  return extendStatics(d, b);\n};\n\nfunction __extends(d, b) {\n  extendStatics(d, b);\n\n  function __() {\n    this.constructor = d;\n  }\n\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nvar __assign = function () {\n  __assign = Object.assign || function __assign(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nfunction massageEventDragMutation(eventMutation, hit0, hit1) {\n  var resource0 = hit0.dateSpan.resourceId;\n  var resource1 = hit1.dateSpan.resourceId;\n\n  if (resource0 && resource1 && resource0 !== resource1) {\n    eventMutation.resourceMutation = {\n      matchResourceId: resource0,\n      setResourceId: resource1\n    };\n  }\n}\n/*\nTODO: all this would be much easier if we were using a hash!\n*/\n\n\nfunction applyEventDefMutation(eventDef, mutation, calendar) {\n  var resourceMutation = mutation.resourceMutation;\n\n  if (resourceMutation && computeResourceEditable(eventDef, calendar)) {\n    var index = eventDef.resourceIds.indexOf(resourceMutation.matchResourceId);\n\n    if (index !== -1) {\n      var resourceIds = eventDef.resourceIds.slice(); // copy\n\n      resourceIds.splice(index, 1); // remove\n\n      if (resourceIds.indexOf(resourceMutation.setResourceId) === -1) {\n        // not already in there\n        resourceIds.push(resourceMutation.setResourceId); // add\n      }\n\n      eventDef.resourceIds = resourceIds;\n    }\n  }\n}\n/*\nHACK\nTODO: use EventUi system instead of this\n*/\n\n\nfunction computeResourceEditable(eventDef, calendar) {\n  var resourceEditable = eventDef.resourceEditable;\n\n  if (resourceEditable == null) {\n    var source = eventDef.sourceId && calendar.state.eventSources[eventDef.sourceId];\n\n    if (source) {\n      resourceEditable = source.extendedProps.resourceEditable; // used the Source::extendedProps hack\n    }\n\n    if (resourceEditable == null) {\n      resourceEditable = calendar.opt('eventResourceEditable');\n\n      if (resourceEditable == null) {\n        resourceEditable = calendar.opt('editable'); // TODO: use defaults system instead\n      }\n    }\n  }\n\n  return resourceEditable;\n}\n\nfunction transformEventDrop(mutation, calendar) {\n  var resourceMutation = mutation.resourceMutation;\n\n  if (resourceMutation) {\n    return {\n      oldResource: calendar.getResourceById(resourceMutation.matchResourceId),\n      newResource: calendar.getResourceById(resourceMutation.setResourceId)\n    };\n  } else {\n    return {\n      oldResource: null,\n      newResource: null\n    };\n  }\n}\n\nvar ResourceDataAdder =\n/** @class */\nfunction () {\n  function ResourceDataAdder() {\n    this.filterResources = memoize(filterResources);\n  }\n\n  ResourceDataAdder.prototype.transform = function (viewProps, viewSpec, calendarProps, allOptions) {\n    if (viewSpec.class.needsResourceData) {\n      return {\n        resourceStore: this.filterResources(calendarProps.resourceStore, allOptions.filterResourcesWithEvents, calendarProps.eventStore, calendarProps.dateProfile.activeRange),\n        resourceEntityExpansions: calendarProps.resourceEntityExpansions\n      };\n    }\n  };\n\n  return ResourceDataAdder;\n}();\n\nfunction filterResources(resourceStore, doFilterResourcesWithEvents, eventStore, activeRange) {\n  if (doFilterResourcesWithEvents) {\n    var instancesInRange = filterEventInstancesInRange(eventStore.instances, activeRange);\n    var hasEvents_1 = computeHasEvents(instancesInRange, eventStore.defs);\n\n    __assign(hasEvents_1, computeAncestorHasEvents(hasEvents_1, resourceStore));\n\n    return filterHash(resourceStore, function (resource, resourceId) {\n      return hasEvents_1[resourceId];\n    });\n  } else {\n    return resourceStore;\n  }\n}\n\nfunction filterEventInstancesInRange(eventInstances, activeRange) {\n  return filterHash(eventInstances, function (eventInstance) {\n    return rangesIntersect(eventInstance.range, activeRange);\n  });\n}\n\nfunction computeHasEvents(eventInstances, eventDefs) {\n  var hasEvents = {};\n\n  for (var instanceId in eventInstances) {\n    var instance = eventInstances[instanceId];\n\n    for (var _i = 0, _a = eventDefs[instance.defId].resourceIds; _i < _a.length; _i++) {\n      var resourceId = _a[_i];\n      hasEvents[resourceId] = true;\n    }\n  }\n\n  return hasEvents;\n}\n/*\nmark resources as having events if any of their ancestors have them\nNOTE: resourceStore might not have all the resources that hasEvents{} has keyed\n*/\n\n\nfunction computeAncestorHasEvents(hasEvents, resourceStore) {\n  var res = {};\n\n  for (var resourceId in hasEvents) {\n    var resource = void 0;\n\n    while (resource = resourceStore[resourceId]) {\n      resourceId = resource.parentId; // now functioning as the parentId\n\n      if (resourceId) {\n        res[resourceId] = true;\n      } else {\n        break;\n      }\n    }\n  }\n\n  return res;\n} // for when non-resource view should be given EventUi info (for event coloring/constraints based off of resource data)\n\n\nvar ResourceEventConfigAdder =\n/** @class */\nfunction () {\n  function ResourceEventConfigAdder() {\n    this.buildResourceEventUis = memoizeOutput(buildResourceEventUis, isPropsEqual);\n    this.injectResourceEventUis = memoize(injectResourceEventUis);\n  }\n\n  ResourceEventConfigAdder.prototype.transform = function (viewProps, viewSpec, calendarProps) {\n    if (!viewSpec.class.needsResourceData) {\n      // is a non-resource view?\n      return {\n        eventUiBases: this.injectResourceEventUis(viewProps.eventUiBases, viewProps.eventStore.defs, this.buildResourceEventUis(calendarProps.resourceStore))\n      };\n    }\n  };\n\n  return ResourceEventConfigAdder;\n}();\n\nfunction buildResourceEventUis(resourceStore) {\n  return mapHash(resourceStore, function (resource) {\n    return resource.ui;\n  });\n}\n\nfunction injectResourceEventUis(eventUiBases, eventDefs, resourceEventUis) {\n  return mapHash(eventUiBases, function (eventUi, defId) {\n    if (defId) {\n      // not the '' key\n      return injectResourceEventUi(eventUi, eventDefs[defId], resourceEventUis);\n    } else {\n      return eventUi;\n    }\n  });\n}\n\nfunction injectResourceEventUi(origEventUi, eventDef, resourceEventUis) {\n  var parts = []; // first resource takes precedence, which fights with the ordering of combineEventUis, thus the unshifts\n\n  for (var _i = 0, _a = eventDef.resourceIds; _i < _a.length; _i++) {\n    var resourceId = _a[_i];\n\n    if (resourceEventUis[resourceId]) {\n      parts.unshift(resourceEventUis[resourceId]);\n    }\n  }\n\n  parts.unshift(origEventUi);\n  return combineEventUis(parts);\n} // for making sure events that have editable resources are always draggable in resource views\n\n\nfunction transformIsDraggable(val, eventDef, eventUi, view) {\n  if (!val) {\n    if (view.viewSpec.class.needsResourceData) {\n      if (computeResourceEditable(eventDef, view.context.calendar)) {\n        // yuck\n        return true;\n      }\n    }\n  }\n\n  return val;\n}\n\nvar RESOURCE_SOURCE_PROPS = {\n  id: String\n};\nvar defs = [];\nvar uid = 0;\n\nfunction registerResourceSourceDef(def) {\n  defs.push(def);\n}\n\nfunction getResourceSourceDef(id) {\n  return defs[id];\n}\n\nfunction doesSourceIgnoreRange(source) {\n  return Boolean(defs[source.sourceDefId].ignoreRange);\n}\n\nfunction parseResourceSource(input) {\n  for (var i = defs.length - 1; i >= 0; i--) {\n    // later-added plugins take precedence\n    var def = defs[i];\n    var meta = def.parseMeta(input);\n\n    if (meta) {\n      var res = parseResourceSourceProps(typeof input === 'object' && input ? input : {}, meta, i);\n      res._raw = input;\n      return res;\n    }\n  }\n\n  return null;\n}\n\nfunction parseResourceSourceProps(input, meta, sourceDefId) {\n  var props = refineProps(input, RESOURCE_SOURCE_PROPS);\n  props.sourceId = String(uid++);\n  props.sourceDefId = sourceDefId;\n  props.meta = meta;\n  props.publicId = props.id;\n  props.isFetching = false;\n  props.latestFetchId = '';\n  props.fetchRange = null;\n  delete props.id;\n  return props;\n}\n\nfunction reduceResourceSource(source, action, dateProfile, calendar) {\n  switch (action.type) {\n    case 'INIT':\n      return createSource(calendar.opt('resources'), calendar);\n\n    case 'RESET_RESOURCE_SOURCE':\n      return createSource(action.resourceSourceInput, calendar, true);\n\n    case 'PREV': // TODO: how do we track all actions that affect dateProfile :(\n\n    case 'NEXT':\n    case 'SET_DATE':\n    case 'SET_VIEW_TYPE':\n      return handleRange(source, dateProfile.activeRange, calendar);\n\n    case 'RECEIVE_RESOURCES':\n    case 'RECEIVE_RESOURCE_ERROR':\n      return receiveResponse(source, action.fetchId, action.fetchRange);\n\n    case 'REFETCH_RESOURCES':\n      return fetchSource(source, dateProfile.activeRange, calendar);\n\n    default:\n      return source;\n  }\n}\n\nvar uid$1 = 0;\n\nfunction createSource(input, calendar, forceFetch) {\n  if (input) {\n    var source = parseResourceSource(input);\n\n    if (forceFetch || !calendar.opt('refetchResourcesOnNavigate')) {\n      // because assumes handleRange will do it later\n      source = fetchSource(source, null, calendar);\n    }\n\n    return source;\n  }\n\n  return null;\n}\n\nfunction handleRange(source, activeRange, calendar) {\n  if (calendar.opt('refetchResourcesOnNavigate') && !doesSourceIgnoreRange(source) && (!source.fetchRange || !rangesEqual(source.fetchRange, activeRange))) {\n    return fetchSource(source, activeRange, calendar);\n  } else {\n    return source;\n  }\n}\n\nfunction fetchSource(source, fetchRange, calendar) {\n  var sourceDef = getResourceSourceDef(source.sourceDefId);\n  var fetchId = String(uid$1++);\n  sourceDef.fetch({\n    resourceSource: source,\n    calendar: calendar,\n    range: fetchRange\n  }, function (res) {\n    // HACK\n    // do before calling dispatch in case dispatch renders synchronously\n    calendar.afterSizingTriggers._resourcesRendered = [null]; // fire once\n\n    calendar.dispatch({\n      type: 'RECEIVE_RESOURCES',\n      fetchId: fetchId,\n      fetchRange: fetchRange,\n      rawResources: res.rawResources\n    });\n  }, function (error) {\n    calendar.dispatch({\n      type: 'RECEIVE_RESOURCE_ERROR',\n      fetchId: fetchId,\n      fetchRange: fetchRange,\n      error: error\n    });\n  });\n  return __assign({}, source, {\n    isFetching: true,\n    latestFetchId: fetchId\n  });\n}\n\nfunction receiveResponse(source, fetchId, fetchRange) {\n  if (fetchId === source.latestFetchId) {\n    return __assign({}, source, {\n      isFetching: false,\n      fetchRange: fetchRange\n    });\n  }\n\n  return source;\n}\n\nvar RESOURCE_PROPS = {\n  id: String,\n  title: String,\n  parentId: String,\n  businessHours: null,\n  children: null,\n  extendedProps: null\n};\nvar PRIVATE_ID_PREFIX = '_fc:';\nvar uid$2 = 0;\n/*\nneeds a full store so that it can populate children too\n*/\n\nfunction parseResource(input, parentId, store, calendar) {\n  if (parentId === void 0) {\n    parentId = '';\n  }\n\n  var leftovers0 = {};\n  var props = refineProps(input, RESOURCE_PROPS, {}, leftovers0);\n  var leftovers1 = {};\n  var ui = processScopedUiProps('event', leftovers0, calendar, leftovers1);\n\n  if (!props.id) {\n    props.id = PRIVATE_ID_PREFIX + uid$2++;\n  }\n\n  if (!props.parentId) {\n    // give precedence to the parentId property\n    props.parentId = parentId;\n  }\n\n  props.businessHours = props.businessHours ? parseBusinessHours(props.businessHours, calendar) : null;\n  props.ui = ui;\n  props.extendedProps = __assign({}, leftovers1, props.extendedProps); // help out ResourceApi from having user modify props\n\n  Object.freeze(ui.classNames);\n  Object.freeze(props.extendedProps);\n  if (store[props.id]) ;else {\n    store[props.id] = props;\n\n    if (props.children) {\n      for (var _i = 0, _a = props.children; _i < _a.length; _i++) {\n        var childInput = _a[_i];\n        parseResource(childInput, props.id, store, calendar);\n      }\n\n      delete props.children;\n    }\n  }\n  return props;\n}\n/*\nTODO: use this in more places\n*/\n\n\nfunction getPublicId(id) {\n  if (id.indexOf(PRIVATE_ID_PREFIX) === 0) {\n    return '';\n  }\n\n  return id;\n}\n\nfunction reduceResourceStore(store, action, source, calendar) {\n  switch (action.type) {\n    case 'INIT':\n      return {};\n\n    case 'RECEIVE_RESOURCES':\n      return receiveRawResources(store, action.rawResources, action.fetchId, source, calendar);\n\n    case 'ADD_RESOURCE':\n      return addResource(store, action.resourceHash);\n\n    case 'REMOVE_RESOURCE':\n      return removeResource(store, action.resourceId);\n\n    case 'SET_RESOURCE_PROP':\n      return setResourceProp(store, action.resourceId, action.propName, action.propValue);\n\n    case 'RESET_RESOURCES':\n      // must make the calendar think each resource is a new object :/\n      return mapHash(store, function (resource) {\n        return __assign({}, resource);\n      });\n\n    default:\n      return store;\n  }\n}\n\nfunction receiveRawResources(existingStore, inputs, fetchId, source, calendar) {\n  if (source.latestFetchId === fetchId) {\n    var nextStore = {};\n\n    for (var _i = 0, inputs_1 = inputs; _i < inputs_1.length; _i++) {\n      var input = inputs_1[_i];\n      parseResource(input, '', nextStore, calendar);\n    }\n\n    return nextStore;\n  } else {\n    return existingStore;\n  }\n}\n\nfunction addResource(existingStore, additions) {\n  // TODO: warn about duplicate IDs\n  return __assign({}, existingStore, additions);\n}\n\nfunction removeResource(existingStore, resourceId) {\n  var newStore = __assign({}, existingStore);\n\n  delete newStore[resourceId]; // promote children\n\n  for (var childResourceId in newStore) {\n    // a child, *maybe* but probably not\n    if (newStore[childResourceId].parentId === resourceId) {\n      newStore[childResourceId] = __assign({}, newStore[childResourceId], {\n        parentId: ''\n      });\n    }\n  }\n\n  return newStore;\n}\n\nfunction setResourceProp(existingStore, resourceId, name, value) {\n  var _a, _b;\n\n  var existingResource = existingStore[resourceId]; // TODO: sanitization\n\n  if (existingResource) {\n    return __assign({}, existingStore, (_a = {}, _a[resourceId] = __assign({}, existingResource, (_b = {}, _b[name] = value, _b)), _a));\n  } else {\n    return existingStore;\n  }\n}\n\nfunction reduceResourceEntityExpansions(expansions, action) {\n  var _a;\n\n  switch (action.type) {\n    case 'INIT':\n      return {};\n\n    case 'SET_RESOURCE_ENTITY_EXPANDED':\n      return __assign({}, expansions, (_a = {}, _a[action.id] = action.isExpanded, _a));\n\n    default:\n      return expansions;\n  }\n}\n\nfunction resourcesReducers(state, action, calendar) {\n  var resourceSource = reduceResourceSource(state.resourceSource, action, state.dateProfile, calendar);\n  var resourceStore = reduceResourceStore(state.resourceStore, action, resourceSource, calendar);\n  var resourceEntityExpansions = reduceResourceEntityExpansions(state.resourceEntityExpansions, action);\n  return __assign({}, state, {\n    resourceSource: resourceSource,\n    resourceStore: resourceStore,\n    resourceEntityExpansions: resourceEntityExpansions\n  });\n}\n\nvar RESOURCE_RELATED_PROPS = {\n  resourceId: String,\n  resourceIds: function (items) {\n    return (items || []).map(function (item) {\n      return String(item);\n    });\n  },\n  resourceEditable: Boolean\n};\n\nfunction parseEventDef(def, props, leftovers) {\n  var resourceRelatedProps = refineProps(props, RESOURCE_RELATED_PROPS, {}, leftovers);\n  var resourceIds = resourceRelatedProps.resourceIds;\n\n  if (resourceRelatedProps.resourceId) {\n    resourceIds.push(resourceRelatedProps.resourceId);\n  }\n\n  def.resourceIds = resourceIds;\n  def.resourceEditable = resourceRelatedProps.resourceEditable;\n}\n\nfunction transformDateSelectionJoin(hit0, hit1) {\n  var resourceId0 = hit0.dateSpan.resourceId;\n  var resourceId1 = hit1.dateSpan.resourceId;\n\n  if (resourceId0 && resourceId1) {\n    if (hit0.component.allowAcrossResources === false && resourceId0 !== resourceId1) {\n      return false;\n    } else {\n      return {\n        resourceId: resourceId0\n      };\n    }\n  }\n}\n\nvar ResourceApi =\n/** @class */\nfunction () {\n  function ResourceApi(calendar, rawResource) {\n    this._calendar = calendar;\n    this._resource = rawResource;\n  }\n\n  ResourceApi.prototype.setProp = function (name, value) {\n    this._calendar.dispatch({\n      type: 'SET_RESOURCE_PROP',\n      resourceId: this._resource.id,\n      propName: name,\n      propValue: value\n    });\n  };\n\n  ResourceApi.prototype.remove = function () {\n    this._calendar.dispatch({\n      type: 'REMOVE_RESOURCE',\n      resourceId: this._resource.id\n    });\n  };\n\n  ResourceApi.prototype.getParent = function () {\n    var calendar = this._calendar;\n    var parentId = this._resource.parentId;\n\n    if (parentId) {\n      return new ResourceApi(calendar, calendar.state.resourceSource[parentId]);\n    } else {\n      return null;\n    }\n  };\n\n  ResourceApi.prototype.getChildren = function () {\n    var thisResourceId = this._resource.id;\n    var calendar = this._calendar;\n    var resourceStore = calendar.state.resourceStore;\n    var childApis = [];\n\n    for (var resourceId in resourceStore) {\n      if (resourceStore[resourceId].parentId === thisResourceId) {\n        childApis.push(new ResourceApi(calendar, resourceStore[resourceId]));\n      }\n    }\n\n    return childApis;\n  };\n  /*\n  this is really inefficient!\n  TODO: make EventApi::resourceIds a hash or keep an index in the Calendar's state\n  */\n\n\n  ResourceApi.prototype.getEvents = function () {\n    var thisResourceId = this._resource.id;\n    var calendar = this._calendar;\n    var _a = calendar.state.eventStore,\n        defs = _a.defs,\n        instances = _a.instances;\n    var eventApis = [];\n\n    for (var instanceId in instances) {\n      var instance = instances[instanceId];\n      var def = defs[instance.defId];\n\n      if (def.resourceIds.indexOf(thisResourceId) !== -1) {\n        // inefficient!!!\n        eventApis.push(new EventApi(calendar, def, instance));\n      }\n    }\n\n    return eventApis;\n  };\n\n  Object.defineProperty(ResourceApi.prototype, \"id\", {\n    get: function () {\n      return this._resource.id;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ResourceApi.prototype, \"title\", {\n    get: function () {\n      return this._resource.title;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ResourceApi.prototype, \"eventConstraint\", {\n    get: function () {\n      return this._resource.ui.constraints[0] || null;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ResourceApi.prototype, \"eventOverlap\", {\n    get: function () {\n      return this._resource.ui.overlap;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ResourceApi.prototype, \"eventAllow\", {\n    get: function () {\n      return this._resource.ui.allows[0] || null;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ResourceApi.prototype, \"eventBackgroundColor\", {\n    get: function () {\n      return this._resource.ui.backgroundColor;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ResourceApi.prototype, \"eventBorderColor\", {\n    get: function () {\n      return this._resource.ui.borderColor;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ResourceApi.prototype, \"eventTextColor\", {\n    get: function () {\n      return this._resource.ui.textColor;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ResourceApi.prototype, \"eventClassNames\", {\n    // NOTE: user can't modify these because Object.freeze was called in event-def parsing\n    get: function () {\n      return this._resource.ui.classNames;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ResourceApi.prototype, \"extendedProps\", {\n    get: function () {\n      return this._resource.extendedProps;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  return ResourceApi;\n}();\n\nCalendar.prototype.addResource = function (input, scrollTo) {\n  var _a;\n\n  if (scrollTo === void 0) {\n    scrollTo = true;\n  }\n\n  var resourceHash;\n  var resource;\n\n  if (input instanceof ResourceApi) {\n    resource = input._resource;\n    resourceHash = (_a = {}, _a[resource.id] = resource, _a);\n  } else {\n    resourceHash = {};\n    resource = parseResource(input, '', resourceHash, this);\n  } // HACK\n\n\n  if (scrollTo) {\n    this.component.view.addScroll({\n      forcedRowId: resource.id\n    });\n  }\n\n  this.dispatch({\n    type: 'ADD_RESOURCE',\n    resourceHash: resourceHash\n  });\n  return new ResourceApi(this, resource);\n};\n\nCalendar.prototype.getResourceById = function (id) {\n  id = String(id);\n\n  if (this.state.resourceStore) {\n    // guard against calendar with no resource functionality\n    var rawResource = this.state.resourceStore[id];\n\n    if (rawResource) {\n      return new ResourceApi(this, rawResource);\n    }\n  }\n\n  return null;\n};\n\nCalendar.prototype.getResources = function () {\n  var resourceStore = this.state.resourceStore;\n  var resourceApis = [];\n\n  if (resourceStore) {\n    // guard against calendar with no resource functionality\n    for (var resourceId in resourceStore) {\n      resourceApis.push(new ResourceApi(this, resourceStore[resourceId]));\n    }\n  }\n\n  return resourceApis;\n};\n\nCalendar.prototype.getTopLevelResources = function () {\n  var resourceStore = this.state.resourceStore;\n  var resourceApis = [];\n\n  if (resourceStore) {\n    // guard against calendar with no resource functionality\n    for (var resourceId in resourceStore) {\n      if (!resourceStore[resourceId].parentId) {\n        resourceApis.push(new ResourceApi(this, resourceStore[resourceId]));\n      }\n    }\n  }\n\n  return resourceApis;\n};\n\nCalendar.prototype.rerenderResources = function () {\n  this.dispatch({\n    type: 'RESET_RESOURCES'\n  });\n};\n\nCalendar.prototype.refetchResources = function () {\n  this.dispatch({\n    type: 'REFETCH_RESOURCES'\n  });\n};\n\nfunction transformDatePoint(dateSpan, calendar) {\n  return dateSpan.resourceId ? {\n    resource: calendar.getResourceById(dateSpan.resourceId)\n  } : {};\n}\n\nfunction transformDateSpan(dateSpan, calendar) {\n  return dateSpan.resourceId ? {\n    resource: calendar.getResourceById(dateSpan.resourceId)\n  } : {};\n}\n/*\nsplits things BASED OFF OF which resources they are associated with.\ncreates a '' entry which is when something has NO resource.\n*/\n\n\nvar ResourceSplitter =\n/** @class */\nfunction (_super) {\n  __extends(ResourceSplitter, _super);\n\n  function ResourceSplitter() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  ResourceSplitter.prototype.getKeyInfo = function (props) {\n    return __assign({\n      '': {}\n    }, props.resourceStore // already has `ui` and `businessHours` keys!\n    );\n  };\n\n  ResourceSplitter.prototype.getKeysForDateSpan = function (dateSpan) {\n    return [dateSpan.resourceId || ''];\n  };\n\n  ResourceSplitter.prototype.getKeysForEventDef = function (eventDef) {\n    var resourceIds = eventDef.resourceIds;\n\n    if (!resourceIds.length) {\n      return [''];\n    }\n\n    return resourceIds;\n  };\n\n  return ResourceSplitter;\n}(Splitter);\n\nfunction isPropsValidWithResources(props, calendar) {\n  var splitter = new ResourceSplitter();\n  var sets = splitter.splitProps(__assign({}, props, {\n    resourceStore: calendar.state.resourceStore\n  }));\n\n  for (var resourceId in sets) {\n    var props_1 = sets[resourceId]; // merge in event data from the non-resource segment\n\n    if (resourceId && sets['']) {\n      // current segment is not the non-resource one, and there IS a non-resource one\n      props_1 = __assign({}, props_1, {\n        eventStore: mergeEventStores(sets[''].eventStore, props_1.eventStore),\n        eventUiBases: __assign({}, sets[''].eventUiBases, props_1.eventUiBases)\n      });\n    }\n\n    if (!isPropsValid(props_1, calendar, {\n      resourceId: resourceId\n    }, filterConfig.bind(null, resourceId))) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nfunction filterConfig(resourceId, config) {\n  return __assign({}, config, {\n    constraints: filterConstraints(resourceId, config.constraints)\n  });\n}\n\nfunction filterConstraints(resourceId, constraints) {\n  return constraints.map(function (constraint) {\n    var defs = constraint.defs;\n\n    if (defs) {\n      // we are dealing with an EventStore\n      // if any of the events define constraints to resources that are NOT this resource,\n      // then this resource is unconditionally prohibited, which is what a `false` value does.\n      for (var defId in defs) {\n        var resourceIds = defs[defId].resourceIds;\n\n        if (resourceIds.length && resourceIds.indexOf(resourceId) === -1) {\n          // TODO: use a hash?!!! (for other reasons too)\n          return false;\n        }\n      }\n    }\n\n    return constraint;\n  });\n}\n\nfunction transformExternalDef(dateSpan) {\n  return dateSpan.resourceId ? {\n    resourceId: dateSpan.resourceId\n  } : {};\n}\n\nfunction transformEventResizeJoin(hit0, hit1) {\n  var component = hit0.component;\n\n  if (component.allowAcrossResources === false && hit0.dateSpan.resourceId !== hit1.dateSpan.resourceId) {\n    return false;\n  }\n}\n\nEventApi.prototype.getResources = function () {\n  var calendar = this._calendar;\n  return this._def.resourceIds.map(function (resourceId) {\n    return calendar.getResourceById(resourceId);\n  });\n};\n\nEventApi.prototype.setResources = function (resources) {\n  var resourceIds = []; // massage resources -> resourceIds\n\n  for (var _i = 0, resources_1 = resources; _i < resources_1.length; _i++) {\n    var resource = resources_1[_i];\n    var resourceId = null;\n\n    if (typeof resource === 'string') {\n      resourceId = resource;\n    } else if (typeof resource === 'number') {\n      resourceId = String(resource);\n    } else if (resource instanceof ResourceApi) {\n      resourceId = resource.id; // guaranteed to always have an ID. hmmm\n    } else {\n      console.warn('unknown resource type: ' + resource);\n    }\n\n    if (resourceId) {\n      resourceIds.push(resourceId);\n    }\n  }\n\n  this.mutate({\n    standardProps: {\n      resourceIds: resourceIds\n    }\n  });\n};\n\nvar RELEASE_DATE = '2020-02-12'; // for Scheduler\n\nvar UPGRADE_WINDOW = 365 + 7; // days. 1 week leeway, for tz shift reasons too\n\nvar LICENSE_INFO_URL = 'http://fullcalendar.io/scheduler/license/';\nvar PRESET_LICENSE_KEYS = ['GPL-My-Project-Is-Open-Source', 'CC-Attribution-NonCommercial-NoDerivatives'];\nvar CSS = {\n  position: 'absolute',\n  'z-index': 99999,\n  bottom: '1px',\n  left: '1px',\n  background: '#eee',\n  'border-color': '#ddd',\n  'border-style': 'solid',\n  'border-width': '1px 1px 0 0',\n  padding: '2px 4px',\n  'font-size': '12px',\n  'border-top-right-radius': '3px'\n};\n\nfunction injectLicenseWarning(containerEl, calendar) {\n  var key = calendar.opt('schedulerLicenseKey');\n\n  if (!isImmuneUrl(window.location.href) && !isValidKey(key)) {\n    appendToElement(containerEl, '<div class=\"fc-license-message\" style=\"' + htmlEscape(cssToStr(CSS)) + '\">' + 'Please use a valid license key. <a href=\"' + LICENSE_INFO_URL + '\">More Info</a>' + '</div>');\n  }\n}\n/*\nThis decryption is not meant to be bulletproof. Just a way to remind about an upgrade.\n*/\n\n\nfunction isValidKey(key) {\n  if (PRESET_LICENSE_KEYS.indexOf(key) !== -1) {\n    return true;\n  }\n\n  var parts = (key || '').match(/^(\\d+)\\-fcs\\-(\\d+)$/);\n\n  if (parts && parts[1].length === 10) {\n    var purchaseDate = new Date(parseInt(parts[2], 10) * 1000);\n    var releaseDate = new Date(config.mockSchedulerReleaseDate || RELEASE_DATE);\n\n    if (isValidDate(releaseDate)) {\n      // token won't be replaced in dev mode\n      var minPurchaseDate = addDays(releaseDate, -UPGRADE_WINDOW);\n\n      if (minPurchaseDate < purchaseDate) {\n        return true;\n      }\n    }\n  }\n\n  return false;\n}\n\nfunction isImmuneUrl(url) {\n  return /\\w+\\:\\/\\/fullcalendar\\.io\\/|\\/examples\\/[\\w-]+\\.html$/.test(url);\n}\n\nvar optionChangeHandlers = {\n  resources: handleResources\n};\n\nfunction handleResources(newSourceInput, calendar, deepEqual) {\n  var oldSourceInput = calendar.state.resourceSource._raw;\n\n  if (!deepEqual(oldSourceInput, newSourceInput)) {\n    calendar.dispatch({\n      type: 'RESET_RESOURCE_SOURCE',\n      resourceSourceInput: newSourceInput\n    });\n  }\n}\n\nregisterResourceSourceDef({\n  ignoreRange: true,\n  parseMeta: function (raw) {\n    if (Array.isArray(raw)) {\n      return raw;\n    } else if (Array.isArray(raw.resources)) {\n      return raw.resources;\n    }\n\n    return null;\n  },\n  fetch: function (arg, successCallback) {\n    successCallback({\n      rawResources: arg.resourceSource.meta\n    });\n  }\n});\nregisterResourceSourceDef({\n  parseMeta: function (raw) {\n    if (typeof raw === 'function') {\n      return raw;\n    } else if (typeof raw.resources === 'function') {\n      return raw.resources;\n    }\n\n    return null;\n  },\n  fetch: function (arg, success, failure) {\n    var dateEnv = arg.calendar.dateEnv;\n    var func = arg.resourceSource.meta;\n    var publicArg = {};\n\n    if (arg.range) {\n      publicArg = {\n        start: dateEnv.toDate(arg.range.start),\n        end: dateEnv.toDate(arg.range.end),\n        startStr: dateEnv.formatIso(arg.range.start),\n        endStr: dateEnv.formatIso(arg.range.end),\n        timeZone: dateEnv.timeZone\n      };\n    } // TODO: make more dry with EventSourceFunc\n    // TODO: accept a response?\n\n\n    unpromisify(func.bind(null, publicArg), function (rawResources) {\n      success({\n        rawResources: rawResources\n      }); // needs an object response\n    }, failure // send errorObj directly to failure callback\n    );\n  }\n});\nregisterResourceSourceDef({\n  parseMeta: function (raw) {\n    if (typeof raw === 'string') {\n      raw = {\n        url: raw\n      };\n    } else if (!raw || typeof raw !== 'object' || !raw.url) {\n      return null;\n    }\n\n    return {\n      url: raw.url,\n      method: (raw.method || 'GET').toUpperCase(),\n      extraParams: raw.extraParams\n    };\n  },\n  fetch: function (arg, successCallback, failureCallback) {\n    var meta = arg.resourceSource.meta;\n    var requestParams = buildRequestParams(meta, arg.range, arg.calendar);\n    requestJson(meta.method, meta.url, requestParams, function (rawResources, xhr) {\n      successCallback({\n        rawResources: rawResources,\n        xhr: xhr\n      });\n    }, function (message, xhr) {\n      failureCallback({\n        message: message,\n        xhr: xhr\n      });\n    });\n  }\n}); // TODO: somehow consolidate with event json feed\n\nfunction buildRequestParams(meta, range, calendar) {\n  var dateEnv = calendar.dateEnv;\n  var startParam;\n  var endParam;\n  var timeZoneParam;\n  var customRequestParams;\n  var params = {};\n\n  if (range) {\n    // startParam = meta.startParam\n    // if (startParam == null) {\n    startParam = calendar.opt('startParam'); // }\n    // endParam = meta.endParam\n    // if (endParam == null) {\n\n    endParam = calendar.opt('endParam'); // }\n    // timeZoneParam = meta.timeZoneParam\n    // if (timeZoneParam == null) {\n\n    timeZoneParam = calendar.opt('timeZoneParam'); // }\n\n    params[startParam] = dateEnv.formatIso(range.start);\n    params[endParam] = dateEnv.formatIso(range.end);\n\n    if (dateEnv.timeZone !== 'local') {\n      params[timeZoneParam] = dateEnv.timeZone;\n    }\n  } // retrieve any outbound GET/POST data from the options\n\n\n  if (typeof meta.extraParams === 'function') {\n    // supplied as a function that returns a key/value object\n    customRequestParams = meta.extraParams();\n  } else {\n    // probably supplied as a straight key/value object\n    customRequestParams = meta.extraParams || {};\n  }\n\n  __assign(params, customRequestParams);\n\n  return params;\n}\n\nfunction buildResourceTextFunc(resourceTextSetting, calendar) {\n  if (typeof resourceTextSetting === 'function') {\n    return function (resource) {\n      return resourceTextSetting(new ResourceApi(calendar, resource));\n    };\n  } else {\n    return function (resource) {\n      return resource.title || getPublicId(resource.id);\n    };\n  }\n}\n\nvar ResourceDayHeader =\n/** @class */\nfunction (_super) {\n  __extends(ResourceDayHeader, _super);\n\n  function ResourceDayHeader(parentEl) {\n    var _this = _super.call(this) || this;\n\n    _this.processOptions = memoize(_this._processOptions);\n    _this.parentEl = parentEl;\n    return _this;\n  }\n\n  ResourceDayHeader.prototype._processOptions = function (options, calendar) {\n    this.datesAboveResources = options.datesAboveResources;\n    this.resourceTextFunc = buildResourceTextFunc(options.resourceText, calendar);\n  };\n\n  ResourceDayHeader.prototype.render = function (props, context) {\n    var options = context.options,\n        calendar = context.calendar,\n        theme = context.theme;\n    this.processOptions(options, calendar);\n    this.parentEl.innerHTML = ''; // because might be nbsp\n\n    this.parentEl.appendChild(this.el = htmlToElement('<div class=\"fc-row ' + theme.getClass('headerRow') + '\">' + '<table class=\"' + theme.getClass('tableGrid') + '\">' + '<thead></thead>' + '</table>' + '</div>'));\n    this.thead = this.el.querySelector('thead');\n    var html;\n    this.dateFormat = createFormatter(options.columnHeaderFormat || computeFallbackHeaderFormat(props.datesRepDistinctDays, props.dates.length));\n\n    if (props.dates.length === 1) {\n      html = this.renderResourceRow(props.resources);\n    } else {\n      if (this.datesAboveResources) {\n        html = this.renderDayAndResourceRows(props.dates, props.resources);\n      } else {\n        html = this.renderResourceAndDayRows(props.resources, props.dates);\n      }\n    }\n\n    this.thead.innerHTML = html;\n    this.processResourceEls(props.resources);\n  };\n\n  ResourceDayHeader.prototype.destroy = function () {\n    removeElement(this.el);\n  };\n\n  ResourceDayHeader.prototype.renderResourceRow = function (resources) {\n    var _this = this;\n\n    var cellHtmls = resources.map(function (resource) {\n      return _this.renderResourceCell(resource, 1);\n    });\n    return this.buildTr(cellHtmls);\n  };\n\n  ResourceDayHeader.prototype.renderDayAndResourceRows = function (dates, resources) {\n    var dateHtmls = [];\n    var resourceHtmls = [];\n\n    for (var _i = 0, dates_1 = dates; _i < dates_1.length; _i++) {\n      var date = dates_1[_i];\n      dateHtmls.push(this.renderDateCell(date, resources.length));\n\n      for (var _a = 0, resources_1 = resources; _a < resources_1.length; _a++) {\n        var resource = resources_1[_a];\n        resourceHtmls.push(this.renderResourceCell(resource, 1, date));\n      }\n    }\n\n    return this.buildTr(dateHtmls) + this.buildTr(resourceHtmls);\n  };\n\n  ResourceDayHeader.prototype.renderResourceAndDayRows = function (resources, dates) {\n    var resourceHtmls = [];\n    var dateHtmls = [];\n\n    for (var _i = 0, resources_2 = resources; _i < resources_2.length; _i++) {\n      var resource = resources_2[_i];\n      resourceHtmls.push(this.renderResourceCell(resource, dates.length));\n\n      for (var _a = 0, dates_2 = dates; _a < dates_2.length; _a++) {\n        var date = dates_2[_a];\n        dateHtmls.push(this.renderDateCell(date, 1, resource));\n      }\n    }\n\n    return this.buildTr(resourceHtmls) + this.buildTr(dateHtmls);\n  }; // Cell Rendering Utils\n  // ----------------------------------------------------------------------------------------------\n  // a cell with the resource name. might be associated with a specific day\n\n\n  ResourceDayHeader.prototype.renderResourceCell = function (resource, colspan, date) {\n    var dateEnv = this.context.dateEnv;\n    return '<th class=\"fc-resource-cell\"' + ' data-resource-id=\"' + resource.id + '\"' + (date ? ' data-date=\"' + dateEnv.formatIso(date, {\n      omitTime: true\n    }) + '\"' : '') + (colspan > 1 ? ' colspan=\"' + colspan + '\"' : '') + '>' + htmlEscape(this.resourceTextFunc(resource)) + '</th>';\n  }; // a cell with date text. might have a resource associated with it\n\n\n  ResourceDayHeader.prototype.renderDateCell = function (date, colspan, resource) {\n    var props = this.props;\n    return renderDateCell(date, props.dateProfile, props.datesRepDistinctDays, props.dates.length * props.resources.length, this.dateFormat, this.context, colspan, resource ? 'data-resource-id=\"' + resource.id + '\"' : '');\n  };\n\n  ResourceDayHeader.prototype.buildTr = function (cellHtmls) {\n    if (!cellHtmls.length) {\n      cellHtmls = ['<td>&nbsp;</td>'];\n    }\n\n    if (this.props.renderIntroHtml) {\n      cellHtmls = [this.props.renderIntroHtml()].concat(cellHtmls);\n    }\n\n    if (this.context.isRtl) {\n      cellHtmls.reverse();\n    }\n\n    return '<tr>' + cellHtmls.join('') + '</tr>';\n  }; // Post-rendering\n  // ----------------------------------------------------------------------------------------------\n  // given a container with already rendered resource cells\n\n\n  ResourceDayHeader.prototype.processResourceEls = function (resources) {\n    var _a = this.context,\n        calendar = _a.calendar,\n        isRtl = _a.isRtl,\n        view = _a.view;\n    findElements(this.thead, '.fc-resource-cell').forEach(function (node, col) {\n      col = col % resources.length;\n\n      if (isRtl) {\n        col = resources.length - 1 - col;\n      }\n\n      var resource = resources[col];\n      calendar.publiclyTrigger('resourceRender', [{\n        resource: new ResourceApi(calendar, resource),\n        el: node,\n        view: view\n      }]);\n    });\n  };\n\n  return ResourceDayHeader;\n}(Component);\n\nvar AbstractResourceDayTable =\n/** @class */\nfunction () {\n  function AbstractResourceDayTable(dayTable, resources) {\n    this.dayTable = dayTable;\n    this.resources = resources;\n    this.resourceIndex = new ResourceIndex(resources);\n    this.rowCnt = dayTable.rowCnt;\n    this.colCnt = dayTable.colCnt * resources.length;\n    this.cells = this.buildCells();\n  }\n\n  AbstractResourceDayTable.prototype.buildCells = function () {\n    var _a = this,\n        rowCnt = _a.rowCnt,\n        dayTable = _a.dayTable,\n        resources = _a.resources;\n\n    var rows = [];\n\n    for (var row = 0; row < rowCnt; row++) {\n      var rowCells = [];\n\n      for (var dateCol = 0; dateCol < dayTable.colCnt; dateCol++) {\n        for (var resourceCol = 0; resourceCol < resources.length; resourceCol++) {\n          var resource = resources[resourceCol];\n          var htmlAttrs = 'data-resource-id=\"' + resource.id + '\"';\n          rowCells[this.computeCol(dateCol, resourceCol)] = {\n            date: dayTable.cells[row][dateCol].date,\n            resource: resource,\n            htmlAttrs: htmlAttrs\n          };\n        }\n      }\n\n      rows.push(rowCells);\n    }\n\n    return rows;\n  };\n\n  return AbstractResourceDayTable;\n}();\n/*\nresources over dates\n*/\n\n\nvar ResourceDayTable =\n/** @class */\nfunction (_super) {\n  __extends(ResourceDayTable, _super);\n\n  function ResourceDayTable() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  ResourceDayTable.prototype.computeCol = function (dateI, resourceI) {\n    return resourceI * this.dayTable.colCnt + dateI;\n  };\n  /*\n  all date ranges are intact\n  */\n\n\n  ResourceDayTable.prototype.computeColRanges = function (dateStartI, dateEndI, resourceI) {\n    return [{\n      firstCol: this.computeCol(dateStartI, resourceI),\n      lastCol: this.computeCol(dateEndI, resourceI),\n      isStart: true,\n      isEnd: true\n    }];\n  };\n\n  return ResourceDayTable;\n}(AbstractResourceDayTable);\n/*\ndates over resources\n*/\n\n\nvar DayResourceTable =\n/** @class */\nfunction (_super) {\n  __extends(DayResourceTable, _super);\n\n  function DayResourceTable() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  DayResourceTable.prototype.computeCol = function (dateI, resourceI) {\n    return dateI * this.resources.length + resourceI;\n  };\n  /*\n  every single day is broken up\n  */\n\n\n  DayResourceTable.prototype.computeColRanges = function (dateStartI, dateEndI, resourceI) {\n    var segs = [];\n\n    for (var i = dateStartI; i <= dateEndI; i++) {\n      var col = this.computeCol(i, resourceI);\n      segs.push({\n        firstCol: col,\n        lastCol: col,\n        isStart: i === dateStartI,\n        isEnd: i === dateEndI\n      });\n    }\n\n    return segs;\n  };\n\n  return DayResourceTable;\n}(AbstractResourceDayTable);\n\nvar ResourceIndex =\n/** @class */\nfunction () {\n  function ResourceIndex(resources) {\n    var indicesById = {};\n    var ids = [];\n\n    for (var i = 0; i < resources.length; i++) {\n      var id = resources[i].id;\n      ids.push(id);\n      indicesById[id] = i;\n    }\n\n    this.ids = ids;\n    this.indicesById = indicesById;\n    this.length = resources.length;\n  }\n\n  return ResourceIndex;\n}();\n/*\nTODO: just use ResourceHash somehow? could then use the generic ResourceSplitter\n*/\n\n\nvar VResourceSplitter =\n/** @class */\nfunction (_super) {\n  __extends(VResourceSplitter, _super);\n\n  function VResourceSplitter() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  VResourceSplitter.prototype.getKeyInfo = function (props) {\n    var resourceDayTable = props.resourceDayTable;\n    var hash = mapHash(resourceDayTable.resourceIndex.indicesById, function (i) {\n      return resourceDayTable.resources[i]; // has `ui` AND `businessHours` keys!\n    }); // :(\n\n    hash[''] = {};\n    return hash;\n  };\n\n  VResourceSplitter.prototype.getKeysForDateSpan = function (dateSpan) {\n    return [dateSpan.resourceId || ''];\n  };\n\n  VResourceSplitter.prototype.getKeysForEventDef = function (eventDef) {\n    var resourceIds = eventDef.resourceIds;\n\n    if (!resourceIds.length) {\n      return [''];\n    }\n\n    return resourceIds;\n  };\n\n  return VResourceSplitter;\n}(Splitter); // joiner\n\n\nvar NO_SEGS = []; // for memoizing\n\nvar VResourceJoiner =\n/** @class */\nfunction () {\n  function VResourceJoiner() {\n    this.joinDateSelection = memoize(this.joinSegs);\n    this.joinBusinessHours = memoize(this.joinSegs);\n    this.joinFgEvents = memoize(this.joinSegs);\n    this.joinBgEvents = memoize(this.joinSegs);\n    this.joinEventDrags = memoize(this.joinInteractions);\n    this.joinEventResizes = memoize(this.joinInteractions);\n  }\n  /*\n  propSets also has a '' key for things with no resource\n  */\n\n\n  VResourceJoiner.prototype.joinProps = function (propSets, resourceDayTable) {\n    var dateSelectionSets = [];\n    var businessHoursSets = [];\n    var fgEventSets = [];\n    var bgEventSets = [];\n    var eventDrags = [];\n    var eventResizes = [];\n    var eventSelection = '';\n    var keys = resourceDayTable.resourceIndex.ids.concat(['']); // add in the all-resource key\n\n    for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n      var key = keys_1[_i];\n      var props = propSets[key];\n      dateSelectionSets.push(props.dateSelectionSegs);\n      businessHoursSets.push(key ? props.businessHourSegs : NO_SEGS); // don't include redundant all-resource businesshours\n\n      fgEventSets.push(key ? props.fgEventSegs : NO_SEGS); // don't include fg all-resource segs\n\n      bgEventSets.push(props.bgEventSegs);\n      eventDrags.push(props.eventDrag);\n      eventResizes.push(props.eventResize);\n      eventSelection = eventSelection || props.eventSelection;\n    }\n\n    return {\n      dateSelectionSegs: this.joinDateSelection.apply(this, [resourceDayTable].concat(dateSelectionSets)),\n      businessHourSegs: this.joinBusinessHours.apply(this, [resourceDayTable].concat(businessHoursSets)),\n      fgEventSegs: this.joinFgEvents.apply(this, [resourceDayTable].concat(fgEventSets)),\n      bgEventSegs: this.joinBgEvents.apply(this, [resourceDayTable].concat(bgEventSets)),\n      eventDrag: this.joinEventDrags.apply(this, [resourceDayTable].concat(eventDrags)),\n      eventResize: this.joinEventResizes.apply(this, [resourceDayTable].concat(eventResizes)),\n      eventSelection: eventSelection\n    };\n  };\n\n  VResourceJoiner.prototype.joinSegs = function (resourceDayTable) {\n    var segGroups = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      segGroups[_i - 1] = arguments[_i];\n    }\n\n    var resourceCnt = resourceDayTable.resources.length;\n    var transformedSegs = [];\n\n    for (var i = 0; i < resourceCnt; i++) {\n      for (var _a = 0, _b = segGroups[i]; _a < _b.length; _a++) {\n        var seg = _b[_a];\n        transformedSegs.push.apply(transformedSegs, this.transformSeg(seg, resourceDayTable, i));\n      }\n\n      for (var _c = 0, _d = segGroups[resourceCnt]; _c < _d.length; _c++) {\n        // one beyond. the all-resource\n        var seg = _d[_c];\n        transformedSegs.push.apply( // one beyond. the all-resource\n        transformedSegs, this.transformSeg(seg, resourceDayTable, i));\n      }\n    }\n\n    return transformedSegs;\n  };\n  /*\n  for expanding non-resource segs to all resources.\n  only for public use.\n  no memoizing.\n  */\n\n\n  VResourceJoiner.prototype.expandSegs = function (resourceDayTable, segs) {\n    var resourceCnt = resourceDayTable.resources.length;\n    var transformedSegs = [];\n\n    for (var i = 0; i < resourceCnt; i++) {\n      for (var _i = 0, segs_1 = segs; _i < segs_1.length; _i++) {\n        var seg = segs_1[_i];\n        transformedSegs.push.apply(transformedSegs, this.transformSeg(seg, resourceDayTable, i));\n      }\n    }\n\n    return transformedSegs;\n  };\n\n  VResourceJoiner.prototype.joinInteractions = function (resourceDayTable) {\n    var interactions = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      interactions[_i - 1] = arguments[_i];\n    }\n\n    var resourceCnt = resourceDayTable.resources.length;\n    var affectedInstances = {};\n    var transformedSegs = [];\n    var isEvent = false;\n    var sourceSeg = null;\n\n    for (var i = 0; i < resourceCnt; i++) {\n      var interaction = interactions[i];\n\n      if (interaction) {\n        for (var _a = 0, _b = interaction.segs; _a < _b.length; _a++) {\n          var seg = _b[_a];\n          transformedSegs.push.apply(transformedSegs, this.transformSeg(seg, resourceDayTable, i) // TODO: templateify Interaction::segs\n          );\n        }\n\n        __assign(affectedInstances, interaction.affectedInstances);\n\n        isEvent = isEvent || interaction.isEvent;\n        sourceSeg = sourceSeg || interaction.sourceSeg;\n      }\n\n      if (interactions[resourceCnt]) {\n        // one beyond. the all-resource\n        for (var _c = 0, _d = interactions[resourceCnt].segs; _c < _d.length; _c++) {\n          var seg = _d[_c];\n          transformedSegs.push.apply(transformedSegs, this.transformSeg(seg, resourceDayTable, i) // TODO: templateify Interaction::segs\n          );\n        }\n      }\n    }\n\n    return {\n      affectedInstances: affectedInstances,\n      segs: transformedSegs,\n      isEvent: isEvent,\n      sourceSeg: sourceSeg\n    };\n  };\n\n  return VResourceJoiner;\n}();\n/*\ndoesn't accept grouping\n*/\n\n\nfunction flattenResources(resourceStore, orderSpecs) {\n  return buildRowNodes(resourceStore, [], orderSpecs, false, {}, true).map(function (node) {\n    return node.resource;\n  });\n}\n\nfunction buildRowNodes(resourceStore, groupSpecs, orderSpecs, isVGrouping, expansions, expansionDefault) {\n  var complexNodes = buildHierarchy(resourceStore, isVGrouping ? -1 : 1, groupSpecs, orderSpecs);\n  var flatNodes = [];\n  flattenNodes(complexNodes, flatNodes, isVGrouping, [], 0, expansions, expansionDefault);\n  return flatNodes;\n}\n\nfunction flattenNodes(complexNodes, res, isVGrouping, rowSpans, depth, expansions, expansionDefault) {\n  for (var i = 0; i < complexNodes.length; i++) {\n    var complexNode = complexNodes[i];\n    var group = complexNode.group;\n\n    if (group) {\n      if (isVGrouping) {\n        var firstRowIndex = res.length;\n        var rowSpanIndex = rowSpans.length;\n        flattenNodes(complexNode.children, res, isVGrouping, rowSpans.concat(0), depth, expansions, expansionDefault);\n\n        if (firstRowIndex < res.length) {\n          var firstRow = res[firstRowIndex];\n          var firstRowSpans = firstRow.rowSpans = firstRow.rowSpans.slice();\n          firstRowSpans[rowSpanIndex] = res.length - firstRowIndex;\n        }\n      } else {\n        var id = group.spec.field + ':' + group.value;\n        var isExpanded = expansions[id] != null ? expansions[id] : expansionDefault;\n        res.push({\n          id: id,\n          group: group,\n          isExpanded: isExpanded\n        });\n\n        if (isExpanded) {\n          flattenNodes(complexNode.children, res, isVGrouping, rowSpans, depth + 1, expansions, expansionDefault);\n        }\n      }\n    } else if (complexNode.resource) {\n      var id = complexNode.resource.id;\n      var isExpanded = expansions[id] != null ? expansions[id] : expansionDefault;\n      res.push({\n        id: id,\n        rowSpans: rowSpans,\n        depth: depth,\n        isExpanded: isExpanded,\n        hasChildren: Boolean(complexNode.children.length),\n        resource: complexNode.resource,\n        resourceFields: complexNode.resourceFields\n      });\n\n      if (isExpanded) {\n        flattenNodes(complexNode.children, res, isVGrouping, rowSpans, depth + 1, expansions, expansionDefault);\n      }\n    }\n  }\n}\n\nfunction buildHierarchy(resourceStore, maxDepth, groupSpecs, orderSpecs) {\n  var resourceNodes = buildResourceNodes(resourceStore, orderSpecs);\n  var builtNodes = [];\n\n  for (var resourceId in resourceNodes) {\n    var resourceNode = resourceNodes[resourceId];\n\n    if (!resourceNode.resource.parentId) {\n      insertResourceNode(resourceNode, builtNodes, groupSpecs, 0, maxDepth, orderSpecs);\n    }\n  }\n\n  return builtNodes;\n}\n\nfunction buildResourceNodes(resourceStore, orderSpecs) {\n  var nodeHash = {};\n\n  for (var resourceId in resourceStore) {\n    var resource = resourceStore[resourceId];\n    nodeHash[resourceId] = {\n      resource: resource,\n      resourceFields: buildResourceFields(resource),\n      children: []\n    };\n  }\n\n  for (var resourceId in resourceStore) {\n    var resource = resourceStore[resourceId];\n\n    if (resource.parentId) {\n      var parentNode = nodeHash[resource.parentId];\n\n      if (parentNode) {\n        insertResourceNodeInSiblings(nodeHash[resourceId], parentNode.children, orderSpecs);\n      }\n    }\n  }\n\n  return nodeHash;\n}\n\nfunction insertResourceNode(resourceNode, nodes, groupSpecs, depth, maxDepth, orderSpecs) {\n  if (groupSpecs.length && (maxDepth === -1 || depth <= maxDepth)) {\n    var groupNode = ensureGroupNodes(resourceNode, nodes, groupSpecs[0]);\n    insertResourceNode(resourceNode, groupNode.children, groupSpecs.slice(1), depth + 1, maxDepth, orderSpecs);\n  } else {\n    insertResourceNodeInSiblings(resourceNode, nodes, orderSpecs);\n  }\n}\n\nfunction ensureGroupNodes(resourceNode, nodes, groupSpec) {\n  var groupValue = resourceNode.resourceFields[groupSpec.field];\n  var groupNode;\n  var newGroupIndex; // find an existing group that matches, or determine the position for a new group\n\n  if (groupSpec.order) {\n    for (newGroupIndex = 0; newGroupIndex < nodes.length; newGroupIndex++) {\n      var node = nodes[newGroupIndex];\n\n      if (node.group) {\n        var cmp = flexibleCompare(groupValue, node.group.value) * groupSpec.order;\n\n        if (cmp === 0) {\n          groupNode = node;\n          break;\n        } else if (cmp < 0) {\n          break;\n        }\n      }\n    }\n  } else {\n    // the groups are unordered\n    for (newGroupIndex = 0; newGroupIndex < nodes.length; newGroupIndex++) {\n      var node = nodes[newGroupIndex];\n\n      if (node.group && groupValue === node.group.value) {\n        groupNode = node;\n        break;\n      }\n    }\n  }\n\n  if (!groupNode) {\n    groupNode = {\n      group: {\n        value: groupValue,\n        spec: groupSpec\n      },\n      children: []\n    };\n    nodes.splice(newGroupIndex, 0, groupNode);\n  }\n\n  return groupNode;\n}\n\nfunction insertResourceNodeInSiblings(resourceNode, siblings, orderSpecs) {\n  var i;\n\n  for (i = 0; i < siblings.length; i++) {\n    var cmp = compareByFieldSpecs(siblings[i].resourceFields, resourceNode.resourceFields, orderSpecs);\n\n    if (cmp > 0) {\n      // went 1 past. insert at i\n      break;\n    }\n  }\n\n  siblings.splice(i, 0, resourceNode);\n}\n\nfunction buildResourceFields(resource) {\n  var obj = __assign({}, resource.extendedProps, resource.ui, resource);\n\n  delete obj.ui;\n  delete obj.extendedProps;\n  return obj;\n}\n\nfunction isGroupsEqual(group0, group1) {\n  return group0.spec === group1.spec && group0.value === group1.value;\n}\n\nvar main = createPlugin({\n  reducers: [resourcesReducers],\n  eventDefParsers: [parseEventDef],\n  isDraggableTransformers: [transformIsDraggable],\n  eventDragMutationMassagers: [massageEventDragMutation],\n  eventDefMutationAppliers: [applyEventDefMutation],\n  dateSelectionTransformers: [transformDateSelectionJoin],\n  datePointTransforms: [transformDatePoint],\n  dateSpanTransforms: [transformDateSpan],\n  viewPropsTransformers: [ResourceDataAdder, ResourceEventConfigAdder],\n  isPropsValid: isPropsValidWithResources,\n  externalDefTransforms: [transformExternalDef],\n  eventResizeJoinTransforms: [transformEventResizeJoin],\n  viewContainerModifiers: [injectLicenseWarning],\n  eventDropTransformers: [transformEventDrop],\n  optionChangeHandlers: optionChangeHandlers\n});\nexport default main;\nexport { AbstractResourceDayTable, DayResourceTable, ResourceApi, ResourceDayHeader, ResourceDayTable, ResourceSplitter, VResourceJoiner, VResourceSplitter, buildResourceFields, buildResourceTextFunc, buildRowNodes, flattenResources, isGroupsEqual };","map":{"version":3,"sources":["C:/Users/Arij/projects/theone/node_modules/@fullcalendar/resource-common/main.esm.js"],"names":["memoize","filterHash","rangesIntersect","memoizeOutput","isPropsEqual","mapHash","combineEventUis","refineProps","rangesEqual","processScopedUiProps","parseBusinessHours","EventApi","Calendar","Splitter","mergeEventStores","isPropsValid","appendToElement","htmlEscape","cssToStr","config","isValidDate","addDays","unpromisify","requestJson","htmlToElement","createFormatter","computeFallbackHeaderFormat","removeElement","renderDateCell","findElements","Component","flexibleCompare","compareByFieldSpecs","createPlugin","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","massageEventDragMutation","eventMutation","hit0","hit1","resource0","dateSpan","resourceId","resource1","resourceMutation","matchResourceId","setResourceId","applyEventDefMutation","eventDef","mutation","calendar","computeResourceEditable","index","resourceIds","indexOf","slice","splice","push","resourceEditable","source","sourceId","state","eventSources","extendedProps","opt","transformEventDrop","oldResource","getResourceById","newResource","ResourceDataAdder","filterResources","transform","viewProps","viewSpec","calendarProps","allOptions","class","needsResourceData","resourceStore","filterResourcesWithEvents","eventStore","dateProfile","activeRange","resourceEntityExpansions","doFilterResourcesWithEvents","instancesInRange","filterEventInstancesInRange","instances","hasEvents_1","computeHasEvents","defs","computeAncestorHasEvents","resource","eventInstances","eventInstance","range","eventDefs","hasEvents","instanceId","instance","_i","_a","defId","res","parentId","ResourceEventConfigAdder","buildResourceEventUis","injectResourceEventUis","eventUiBases","ui","resourceEventUis","eventUi","injectResourceEventUi","origEventUi","parts","unshift","transformIsDraggable","val","view","context","RESOURCE_SOURCE_PROPS","id","String","uid","registerResourceSourceDef","def","getResourceSourceDef","doesSourceIgnoreRange","Boolean","sourceDefId","ignoreRange","parseResourceSource","input","meta","parseMeta","parseResourceSourceProps","_raw","props","publicId","isFetching","latestFetchId","fetchRange","reduceResourceSource","action","type","createSource","resourceSourceInput","handleRange","receiveResponse","fetchId","fetchSource","uid$1","forceFetch","sourceDef","fetch","resourceSource","afterSizingTriggers","_resourcesRendered","dispatch","rawResources","error","RESOURCE_PROPS","title","businessHours","children","PRIVATE_ID_PREFIX","uid$2","parseResource","store","leftovers0","leftovers1","freeze","classNames","childInput","getPublicId","reduceResourceStore","receiveRawResources","addResource","resourceHash","removeResource","setResourceProp","propName","propValue","existingStore","inputs","nextStore","inputs_1","additions","newStore","childResourceId","name","value","_b","existingResource","reduceResourceEntityExpansions","expansions","isExpanded","resourcesReducers","RESOURCE_RELATED_PROPS","items","map","item","parseEventDef","leftovers","resourceRelatedProps","transformDateSelectionJoin","resourceId0","resourceId1","component","allowAcrossResources","ResourceApi","rawResource","_calendar","_resource","setProp","remove","getParent","getChildren","thisResourceId","childApis","getEvents","eventApis","defineProperty","get","enumerable","configurable","constraints","overlap","allows","backgroundColor","borderColor","textColor","scrollTo","addScroll","forcedRowId","getResources","resourceApis","getTopLevelResources","rerenderResources","refetchResources","transformDatePoint","transformDateSpan","ResourceSplitter","_super","getKeyInfo","getKeysForDateSpan","getKeysForEventDef","isPropsValidWithResources","splitter","sets","splitProps","props_1","filterConfig","bind","filterConstraints","constraint","transformExternalDef","transformEventResizeJoin","_def","setResources","resources","resources_1","console","warn","mutate","standardProps","RELEASE_DATE","UPGRADE_WINDOW","LICENSE_INFO_URL","PRESET_LICENSE_KEYS","CSS","position","bottom","left","background","padding","injectLicenseWarning","containerEl","key","isImmuneUrl","window","location","href","isValidKey","match","purchaseDate","Date","parseInt","releaseDate","mockSchedulerReleaseDate","minPurchaseDate","url","test","optionChangeHandlers","handleResources","newSourceInput","deepEqual","oldSourceInput","raw","isArray","arg","successCallback","success","failure","dateEnv","func","publicArg","start","toDate","end","startStr","formatIso","endStr","timeZone","method","toUpperCase","extraParams","failureCallback","requestParams","buildRequestParams","xhr","message","startParam","endParam","timeZoneParam","customRequestParams","params","buildResourceTextFunc","resourceTextSetting","ResourceDayHeader","parentEl","_this","processOptions","_processOptions","options","datesAboveResources","resourceTextFunc","resourceText","render","theme","innerHTML","appendChild","el","getClass","thead","querySelector","html","dateFormat","columnHeaderFormat","datesRepDistinctDays","dates","renderResourceRow","renderDayAndResourceRows","renderResourceAndDayRows","processResourceEls","destroy","cellHtmls","renderResourceCell","buildTr","dateHtmls","resourceHtmls","dates_1","date","resources_2","dates_2","colspan","omitTime","renderIntroHtml","concat","isRtl","reverse","join","forEach","node","col","publiclyTrigger","AbstractResourceDayTable","dayTable","resourceIndex","ResourceIndex","rowCnt","colCnt","cells","buildCells","rows","row","rowCells","dateCol","resourceCol","htmlAttrs","computeCol","ResourceDayTable","dateI","resourceI","computeColRanges","dateStartI","dateEndI","firstCol","lastCol","isStart","isEnd","DayResourceTable","segs","indicesById","ids","VResourceSplitter","resourceDayTable","hash","NO_SEGS","VResourceJoiner","joinDateSelection","joinSegs","joinBusinessHours","joinFgEvents","joinBgEvents","joinEventDrags","joinInteractions","joinEventResizes","joinProps","propSets","dateSelectionSets","businessHoursSets","fgEventSets","bgEventSets","eventDrags","eventResizes","eventSelection","keys","keys_1","dateSelectionSegs","businessHourSegs","fgEventSegs","bgEventSegs","eventDrag","eventResize","segGroups","resourceCnt","transformedSegs","seg","transformSeg","_c","_d","expandSegs","segs_1","interactions","affectedInstances","isEvent","sourceSeg","interaction","flattenResources","orderSpecs","buildRowNodes","groupSpecs","isVGrouping","expansionDefault","complexNodes","buildHierarchy","flatNodes","flattenNodes","rowSpans","depth","complexNode","group","firstRowIndex","rowSpanIndex","firstRow","firstRowSpans","spec","field","hasChildren","resourceFields","maxDepth","resourceNodes","buildResourceNodes","builtNodes","resourceNode","insertResourceNode","nodeHash","buildResourceFields","parentNode","insertResourceNodeInSiblings","nodes","groupNode","ensureGroupNodes","groupSpec","groupValue","newGroupIndex","order","cmp","siblings","obj","isGroupsEqual","group0","group1","main","reducers","eventDefParsers","isDraggableTransformers","eventDragMutationMassagers","eventDefMutationAppliers","dateSelectionTransformers","datePointTransforms","dateSpanTransforms","viewPropsTransformers","externalDefTransforms","eventResizeJoinTransforms","viewContainerModifiers","eventDropTransformers"],"mappings":"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","sourcesContent":["/*!\nFullCalendar Resources Common Plugin v4.4.0\nDocs & License: https://fullcalendar.io/scheduler\n(c) 2019 Adam Shaw\n*/\n\nimport { memoize, filterHash, rangesIntersect, memoizeOutput, isPropsEqual, mapHash, combineEventUis, refineProps, rangesEqual, processScopedUiProps, parseBusinessHours, EventApi, Calendar, Splitter, mergeEventStores, isPropsValid, appendToElement, htmlEscape, cssToStr, config, isValidDate, addDays, unpromisify, requestJson, htmlToElement, createFormatter, computeFallbackHeaderFormat, removeElement, renderDateCell, findElements, Component, flexibleCompare, compareByFieldSpecs, createPlugin } from '@fullcalendar/core';\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nfunction __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\n\nfunction massageEventDragMutation(eventMutation, hit0, hit1) {\n    var resource0 = hit0.dateSpan.resourceId;\n    var resource1 = hit1.dateSpan.resourceId;\n    if (resource0 && resource1 &&\n        resource0 !== resource1) {\n        eventMutation.resourceMutation = {\n            matchResourceId: resource0,\n            setResourceId: resource1\n        };\n    }\n}\n/*\nTODO: all this would be much easier if we were using a hash!\n*/\nfunction applyEventDefMutation(eventDef, mutation, calendar) {\n    var resourceMutation = mutation.resourceMutation;\n    if (resourceMutation && computeResourceEditable(eventDef, calendar)) {\n        var index = eventDef.resourceIds.indexOf(resourceMutation.matchResourceId);\n        if (index !== -1) {\n            var resourceIds = eventDef.resourceIds.slice(); // copy\n            resourceIds.splice(index, 1); // remove\n            if (resourceIds.indexOf(resourceMutation.setResourceId) === -1) { // not already in there\n                resourceIds.push(resourceMutation.setResourceId); // add\n            }\n            eventDef.resourceIds = resourceIds;\n        }\n    }\n}\n/*\nHACK\nTODO: use EventUi system instead of this\n*/\nfunction computeResourceEditable(eventDef, calendar) {\n    var resourceEditable = eventDef.resourceEditable;\n    if (resourceEditable == null) {\n        var source = eventDef.sourceId && calendar.state.eventSources[eventDef.sourceId];\n        if (source) {\n            resourceEditable = source.extendedProps.resourceEditable; // used the Source::extendedProps hack\n        }\n        if (resourceEditable == null) {\n            resourceEditable = calendar.opt('eventResourceEditable');\n            if (resourceEditable == null) {\n                resourceEditable = calendar.opt('editable'); // TODO: use defaults system instead\n            }\n        }\n    }\n    return resourceEditable;\n}\nfunction transformEventDrop(mutation, calendar) {\n    var resourceMutation = mutation.resourceMutation;\n    if (resourceMutation) {\n        return {\n            oldResource: calendar.getResourceById(resourceMutation.matchResourceId),\n            newResource: calendar.getResourceById(resourceMutation.setResourceId)\n        };\n    }\n    else {\n        return {\n            oldResource: null,\n            newResource: null\n        };\n    }\n}\n\nvar ResourceDataAdder = /** @class */ (function () {\n    function ResourceDataAdder() {\n        this.filterResources = memoize(filterResources);\n    }\n    ResourceDataAdder.prototype.transform = function (viewProps, viewSpec, calendarProps, allOptions) {\n        if (viewSpec.class.needsResourceData) {\n            return {\n                resourceStore: this.filterResources(calendarProps.resourceStore, allOptions.filterResourcesWithEvents, calendarProps.eventStore, calendarProps.dateProfile.activeRange),\n                resourceEntityExpansions: calendarProps.resourceEntityExpansions\n            };\n        }\n    };\n    return ResourceDataAdder;\n}());\nfunction filterResources(resourceStore, doFilterResourcesWithEvents, eventStore, activeRange) {\n    if (doFilterResourcesWithEvents) {\n        var instancesInRange = filterEventInstancesInRange(eventStore.instances, activeRange);\n        var hasEvents_1 = computeHasEvents(instancesInRange, eventStore.defs);\n        __assign(hasEvents_1, computeAncestorHasEvents(hasEvents_1, resourceStore));\n        return filterHash(resourceStore, function (resource, resourceId) {\n            return hasEvents_1[resourceId];\n        });\n    }\n    else {\n        return resourceStore;\n    }\n}\nfunction filterEventInstancesInRange(eventInstances, activeRange) {\n    return filterHash(eventInstances, function (eventInstance) {\n        return rangesIntersect(eventInstance.range, activeRange);\n    });\n}\nfunction computeHasEvents(eventInstances, eventDefs) {\n    var hasEvents = {};\n    for (var instanceId in eventInstances) {\n        var instance = eventInstances[instanceId];\n        for (var _i = 0, _a = eventDefs[instance.defId].resourceIds; _i < _a.length; _i++) {\n            var resourceId = _a[_i];\n            hasEvents[resourceId] = true;\n        }\n    }\n    return hasEvents;\n}\n/*\nmark resources as having events if any of their ancestors have them\nNOTE: resourceStore might not have all the resources that hasEvents{} has keyed\n*/\nfunction computeAncestorHasEvents(hasEvents, resourceStore) {\n    var res = {};\n    for (var resourceId in hasEvents) {\n        var resource = void 0;\n        while ((resource = resourceStore[resourceId])) {\n            resourceId = resource.parentId; // now functioning as the parentId\n            if (resourceId) {\n                res[resourceId] = true;\n            }\n            else {\n                break;\n            }\n        }\n    }\n    return res;\n}\n// for when non-resource view should be given EventUi info (for event coloring/constraints based off of resource data)\nvar ResourceEventConfigAdder = /** @class */ (function () {\n    function ResourceEventConfigAdder() {\n        this.buildResourceEventUis = memoizeOutput(buildResourceEventUis, isPropsEqual);\n        this.injectResourceEventUis = memoize(injectResourceEventUis);\n    }\n    ResourceEventConfigAdder.prototype.transform = function (viewProps, viewSpec, calendarProps) {\n        if (!viewSpec.class.needsResourceData) { // is a non-resource view?\n            return {\n                eventUiBases: this.injectResourceEventUis(viewProps.eventUiBases, viewProps.eventStore.defs, this.buildResourceEventUis(calendarProps.resourceStore))\n            };\n        }\n    };\n    return ResourceEventConfigAdder;\n}());\nfunction buildResourceEventUis(resourceStore) {\n    return mapHash(resourceStore, function (resource) {\n        return resource.ui;\n    });\n}\nfunction injectResourceEventUis(eventUiBases, eventDefs, resourceEventUis) {\n    return mapHash(eventUiBases, function (eventUi, defId) {\n        if (defId) { // not the '' key\n            return injectResourceEventUi(eventUi, eventDefs[defId], resourceEventUis);\n        }\n        else {\n            return eventUi;\n        }\n    });\n}\nfunction injectResourceEventUi(origEventUi, eventDef, resourceEventUis) {\n    var parts = [];\n    // first resource takes precedence, which fights with the ordering of combineEventUis, thus the unshifts\n    for (var _i = 0, _a = eventDef.resourceIds; _i < _a.length; _i++) {\n        var resourceId = _a[_i];\n        if (resourceEventUis[resourceId]) {\n            parts.unshift(resourceEventUis[resourceId]);\n        }\n    }\n    parts.unshift(origEventUi);\n    return combineEventUis(parts);\n}\n// for making sure events that have editable resources are always draggable in resource views\nfunction transformIsDraggable(val, eventDef, eventUi, view) {\n    if (!val) {\n        if (view.viewSpec.class.needsResourceData) {\n            if (computeResourceEditable(eventDef, view.context.calendar)) { // yuck\n                return true;\n            }\n        }\n    }\n    return val;\n}\n\nvar RESOURCE_SOURCE_PROPS = {\n    id: String\n};\nvar defs = [];\nvar uid = 0;\nfunction registerResourceSourceDef(def) {\n    defs.push(def);\n}\nfunction getResourceSourceDef(id) {\n    return defs[id];\n}\nfunction doesSourceIgnoreRange(source) {\n    return Boolean(defs[source.sourceDefId].ignoreRange);\n}\nfunction parseResourceSource(input) {\n    for (var i = defs.length - 1; i >= 0; i--) { // later-added plugins take precedence\n        var def = defs[i];\n        var meta = def.parseMeta(input);\n        if (meta) {\n            var res = parseResourceSourceProps((typeof input === 'object' && input) ? input : {}, meta, i);\n            res._raw = input;\n            return res;\n        }\n    }\n    return null;\n}\nfunction parseResourceSourceProps(input, meta, sourceDefId) {\n    var props = refineProps(input, RESOURCE_SOURCE_PROPS);\n    props.sourceId = String(uid++);\n    props.sourceDefId = sourceDefId;\n    props.meta = meta;\n    props.publicId = props.id;\n    props.isFetching = false;\n    props.latestFetchId = '';\n    props.fetchRange = null;\n    delete props.id;\n    return props;\n}\n\nfunction reduceResourceSource (source, action, dateProfile, calendar) {\n    switch (action.type) {\n        case 'INIT':\n            return createSource(calendar.opt('resources'), calendar);\n        case 'RESET_RESOURCE_SOURCE':\n            return createSource(action.resourceSourceInput, calendar, true);\n        case 'PREV': // TODO: how do we track all actions that affect dateProfile :(\n        case 'NEXT':\n        case 'SET_DATE':\n        case 'SET_VIEW_TYPE':\n            return handleRange(source, dateProfile.activeRange, calendar);\n        case 'RECEIVE_RESOURCES':\n        case 'RECEIVE_RESOURCE_ERROR':\n            return receiveResponse(source, action.fetchId, action.fetchRange);\n        case 'REFETCH_RESOURCES':\n            return fetchSource(source, dateProfile.activeRange, calendar);\n        default:\n            return source;\n    }\n}\nvar uid$1 = 0;\nfunction createSource(input, calendar, forceFetch) {\n    if (input) {\n        var source = parseResourceSource(input);\n        if (forceFetch || !calendar.opt('refetchResourcesOnNavigate')) { // because assumes handleRange will do it later\n            source = fetchSource(source, null, calendar);\n        }\n        return source;\n    }\n    return null;\n}\nfunction handleRange(source, activeRange, calendar) {\n    if (calendar.opt('refetchResourcesOnNavigate') &&\n        !doesSourceIgnoreRange(source) &&\n        (!source.fetchRange || !rangesEqual(source.fetchRange, activeRange))) {\n        return fetchSource(source, activeRange, calendar);\n    }\n    else {\n        return source;\n    }\n}\nfunction fetchSource(source, fetchRange, calendar) {\n    var sourceDef = getResourceSourceDef(source.sourceDefId);\n    var fetchId = String(uid$1++);\n    sourceDef.fetch({\n        resourceSource: source,\n        calendar: calendar,\n        range: fetchRange\n    }, function (res) {\n        // HACK\n        // do before calling dispatch in case dispatch renders synchronously\n        calendar.afterSizingTriggers._resourcesRendered = [null]; // fire once\n        calendar.dispatch({\n            type: 'RECEIVE_RESOURCES',\n            fetchId: fetchId,\n            fetchRange: fetchRange,\n            rawResources: res.rawResources\n        });\n    }, function (error) {\n        calendar.dispatch({\n            type: 'RECEIVE_RESOURCE_ERROR',\n            fetchId: fetchId,\n            fetchRange: fetchRange,\n            error: error\n        });\n    });\n    return __assign({}, source, { isFetching: true, latestFetchId: fetchId });\n}\nfunction receiveResponse(source, fetchId, fetchRange) {\n    if (fetchId === source.latestFetchId) {\n        return __assign({}, source, { isFetching: false, fetchRange: fetchRange });\n    }\n    return source;\n}\n\nvar RESOURCE_PROPS = {\n    id: String,\n    title: String,\n    parentId: String,\n    businessHours: null,\n    children: null,\n    extendedProps: null\n};\nvar PRIVATE_ID_PREFIX = '_fc:';\nvar uid$2 = 0;\n/*\nneeds a full store so that it can populate children too\n*/\nfunction parseResource(input, parentId, store, calendar) {\n    if (parentId === void 0) { parentId = ''; }\n    var leftovers0 = {};\n    var props = refineProps(input, RESOURCE_PROPS, {}, leftovers0);\n    var leftovers1 = {};\n    var ui = processScopedUiProps('event', leftovers0, calendar, leftovers1);\n    if (!props.id) {\n        props.id = PRIVATE_ID_PREFIX + (uid$2++);\n    }\n    if (!props.parentId) { // give precedence to the parentId property\n        props.parentId = parentId;\n    }\n    props.businessHours = props.businessHours ? parseBusinessHours(props.businessHours, calendar) : null;\n    props.ui = ui;\n    props.extendedProps = __assign({}, leftovers1, props.extendedProps);\n    // help out ResourceApi from having user modify props\n    Object.freeze(ui.classNames);\n    Object.freeze(props.extendedProps);\n    if (store[props.id]) ;\n    else {\n        store[props.id] = props;\n        if (props.children) {\n            for (var _i = 0, _a = props.children; _i < _a.length; _i++) {\n                var childInput = _a[_i];\n                parseResource(childInput, props.id, store, calendar);\n            }\n            delete props.children;\n        }\n    }\n    return props;\n}\n/*\nTODO: use this in more places\n*/\nfunction getPublicId(id) {\n    if (id.indexOf(PRIVATE_ID_PREFIX) === 0) {\n        return '';\n    }\n    return id;\n}\n\nfunction reduceResourceStore (store, action, source, calendar) {\n    switch (action.type) {\n        case 'INIT':\n            return {};\n        case 'RECEIVE_RESOURCES':\n            return receiveRawResources(store, action.rawResources, action.fetchId, source, calendar);\n        case 'ADD_RESOURCE':\n            return addResource(store, action.resourceHash);\n        case 'REMOVE_RESOURCE':\n            return removeResource(store, action.resourceId);\n        case 'SET_RESOURCE_PROP':\n            return setResourceProp(store, action.resourceId, action.propName, action.propValue);\n        case 'RESET_RESOURCES':\n            // must make the calendar think each resource is a new object :/\n            return mapHash(store, function (resource) {\n                return __assign({}, resource);\n            });\n        default:\n            return store;\n    }\n}\nfunction receiveRawResources(existingStore, inputs, fetchId, source, calendar) {\n    if (source.latestFetchId === fetchId) {\n        var nextStore = {};\n        for (var _i = 0, inputs_1 = inputs; _i < inputs_1.length; _i++) {\n            var input = inputs_1[_i];\n            parseResource(input, '', nextStore, calendar);\n        }\n        return nextStore;\n    }\n    else {\n        return existingStore;\n    }\n}\nfunction addResource(existingStore, additions) {\n    // TODO: warn about duplicate IDs\n    return __assign({}, existingStore, additions);\n}\nfunction removeResource(existingStore, resourceId) {\n    var newStore = __assign({}, existingStore);\n    delete newStore[resourceId];\n    // promote children\n    for (var childResourceId in newStore) { // a child, *maybe* but probably not\n        if (newStore[childResourceId].parentId === resourceId) {\n            newStore[childResourceId] = __assign({}, newStore[childResourceId], { parentId: '' });\n        }\n    }\n    return newStore;\n}\nfunction setResourceProp(existingStore, resourceId, name, value) {\n    var _a, _b;\n    var existingResource = existingStore[resourceId];\n    // TODO: sanitization\n    if (existingResource) {\n        return __assign({}, existingStore, (_a = {}, _a[resourceId] = __assign({}, existingResource, (_b = {}, _b[name] = value, _b)), _a));\n    }\n    else {\n        return existingStore;\n    }\n}\n\nfunction reduceResourceEntityExpansions(expansions, action) {\n    var _a;\n    switch (action.type) {\n        case 'INIT':\n            return {};\n        case 'SET_RESOURCE_ENTITY_EXPANDED':\n            return __assign({}, expansions, (_a = {}, _a[action.id] = action.isExpanded, _a));\n        default:\n            return expansions;\n    }\n}\n\nfunction resourcesReducers (state, action, calendar) {\n    var resourceSource = reduceResourceSource(state.resourceSource, action, state.dateProfile, calendar);\n    var resourceStore = reduceResourceStore(state.resourceStore, action, resourceSource, calendar);\n    var resourceEntityExpansions = reduceResourceEntityExpansions(state.resourceEntityExpansions, action);\n    return __assign({}, state, { resourceSource: resourceSource,\n        resourceStore: resourceStore,\n        resourceEntityExpansions: resourceEntityExpansions });\n}\n\nvar RESOURCE_RELATED_PROPS = {\n    resourceId: String,\n    resourceIds: function (items) {\n        return (items || []).map(function (item) {\n            return String(item);\n        });\n    },\n    resourceEditable: Boolean\n};\nfunction parseEventDef(def, props, leftovers) {\n    var resourceRelatedProps = refineProps(props, RESOURCE_RELATED_PROPS, {}, leftovers);\n    var resourceIds = resourceRelatedProps.resourceIds;\n    if (resourceRelatedProps.resourceId) {\n        resourceIds.push(resourceRelatedProps.resourceId);\n    }\n    def.resourceIds = resourceIds;\n    def.resourceEditable = resourceRelatedProps.resourceEditable;\n}\n\nfunction transformDateSelectionJoin(hit0, hit1) {\n    var resourceId0 = hit0.dateSpan.resourceId;\n    var resourceId1 = hit1.dateSpan.resourceId;\n    if (resourceId0 && resourceId1) {\n        if (hit0.component.allowAcrossResources === false &&\n            resourceId0 !== resourceId1) {\n            return false;\n        }\n        else {\n            return { resourceId: resourceId0 };\n        }\n    }\n}\n\nvar ResourceApi = /** @class */ (function () {\n    function ResourceApi(calendar, rawResource) {\n        this._calendar = calendar;\n        this._resource = rawResource;\n    }\n    ResourceApi.prototype.setProp = function (name, value) {\n        this._calendar.dispatch({\n            type: 'SET_RESOURCE_PROP',\n            resourceId: this._resource.id,\n            propName: name,\n            propValue: value\n        });\n    };\n    ResourceApi.prototype.remove = function () {\n        this._calendar.dispatch({\n            type: 'REMOVE_RESOURCE',\n            resourceId: this._resource.id\n        });\n    };\n    ResourceApi.prototype.getParent = function () {\n        var calendar = this._calendar;\n        var parentId = this._resource.parentId;\n        if (parentId) {\n            return new ResourceApi(calendar, calendar.state.resourceSource[parentId]);\n        }\n        else {\n            return null;\n        }\n    };\n    ResourceApi.prototype.getChildren = function () {\n        var thisResourceId = this._resource.id;\n        var calendar = this._calendar;\n        var resourceStore = calendar.state.resourceStore;\n        var childApis = [];\n        for (var resourceId in resourceStore) {\n            if (resourceStore[resourceId].parentId === thisResourceId) {\n                childApis.push(new ResourceApi(calendar, resourceStore[resourceId]));\n            }\n        }\n        return childApis;\n    };\n    /*\n    this is really inefficient!\n    TODO: make EventApi::resourceIds a hash or keep an index in the Calendar's state\n    */\n    ResourceApi.prototype.getEvents = function () {\n        var thisResourceId = this._resource.id;\n        var calendar = this._calendar;\n        var _a = calendar.state.eventStore, defs = _a.defs, instances = _a.instances;\n        var eventApis = [];\n        for (var instanceId in instances) {\n            var instance = instances[instanceId];\n            var def = defs[instance.defId];\n            if (def.resourceIds.indexOf(thisResourceId) !== -1) { // inefficient!!!\n                eventApis.push(new EventApi(calendar, def, instance));\n            }\n        }\n        return eventApis;\n    };\n    Object.defineProperty(ResourceApi.prototype, \"id\", {\n        get: function () { return this._resource.id; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ResourceApi.prototype, \"title\", {\n        get: function () { return this._resource.title; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ResourceApi.prototype, \"eventConstraint\", {\n        get: function () { return this._resource.ui.constraints[0] || null; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ResourceApi.prototype, \"eventOverlap\", {\n        get: function () { return this._resource.ui.overlap; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ResourceApi.prototype, \"eventAllow\", {\n        get: function () { return this._resource.ui.allows[0] || null; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ResourceApi.prototype, \"eventBackgroundColor\", {\n        get: function () { return this._resource.ui.backgroundColor; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ResourceApi.prototype, \"eventBorderColor\", {\n        get: function () { return this._resource.ui.borderColor; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ResourceApi.prototype, \"eventTextColor\", {\n        get: function () { return this._resource.ui.textColor; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ResourceApi.prototype, \"eventClassNames\", {\n        // NOTE: user can't modify these because Object.freeze was called in event-def parsing\n        get: function () { return this._resource.ui.classNames; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ResourceApi.prototype, \"extendedProps\", {\n        get: function () { return this._resource.extendedProps; },\n        enumerable: true,\n        configurable: true\n    });\n    return ResourceApi;\n}());\n\nCalendar.prototype.addResource = function (input, scrollTo) {\n    var _a;\n    if (scrollTo === void 0) { scrollTo = true; }\n    var resourceHash;\n    var resource;\n    if (input instanceof ResourceApi) {\n        resource = input._resource;\n        resourceHash = (_a = {}, _a[resource.id] = resource, _a);\n    }\n    else {\n        resourceHash = {};\n        resource = parseResource(input, '', resourceHash, this);\n    }\n    // HACK\n    if (scrollTo) {\n        this.component.view.addScroll({ forcedRowId: resource.id });\n    }\n    this.dispatch({\n        type: 'ADD_RESOURCE',\n        resourceHash: resourceHash\n    });\n    return new ResourceApi(this, resource);\n};\nCalendar.prototype.getResourceById = function (id) {\n    id = String(id);\n    if (this.state.resourceStore) { // guard against calendar with no resource functionality\n        var rawResource = this.state.resourceStore[id];\n        if (rawResource) {\n            return new ResourceApi(this, rawResource);\n        }\n    }\n    return null;\n};\nCalendar.prototype.getResources = function () {\n    var resourceStore = this.state.resourceStore;\n    var resourceApis = [];\n    if (resourceStore) { // guard against calendar with no resource functionality\n        for (var resourceId in resourceStore) {\n            resourceApis.push(new ResourceApi(this, resourceStore[resourceId]));\n        }\n    }\n    return resourceApis;\n};\nCalendar.prototype.getTopLevelResources = function () {\n    var resourceStore = this.state.resourceStore;\n    var resourceApis = [];\n    if (resourceStore) { // guard against calendar with no resource functionality\n        for (var resourceId in resourceStore) {\n            if (!resourceStore[resourceId].parentId) {\n                resourceApis.push(new ResourceApi(this, resourceStore[resourceId]));\n            }\n        }\n    }\n    return resourceApis;\n};\nCalendar.prototype.rerenderResources = function () {\n    this.dispatch({\n        type: 'RESET_RESOURCES'\n    });\n};\nCalendar.prototype.refetchResources = function () {\n    this.dispatch({\n        type: 'REFETCH_RESOURCES'\n    });\n};\nfunction transformDatePoint(dateSpan, calendar) {\n    return dateSpan.resourceId ?\n        { resource: calendar.getResourceById(dateSpan.resourceId) } :\n        {};\n}\nfunction transformDateSpan(dateSpan, calendar) {\n    return dateSpan.resourceId ?\n        { resource: calendar.getResourceById(dateSpan.resourceId) } :\n        {};\n}\n\n/*\nsplits things BASED OFF OF which resources they are associated with.\ncreates a '' entry which is when something has NO resource.\n*/\nvar ResourceSplitter = /** @class */ (function (_super) {\n    __extends(ResourceSplitter, _super);\n    function ResourceSplitter() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ResourceSplitter.prototype.getKeyInfo = function (props) {\n        return __assign({ '': {} }, props.resourceStore // already has `ui` and `businessHours` keys!\n        );\n    };\n    ResourceSplitter.prototype.getKeysForDateSpan = function (dateSpan) {\n        return [dateSpan.resourceId || ''];\n    };\n    ResourceSplitter.prototype.getKeysForEventDef = function (eventDef) {\n        var resourceIds = eventDef.resourceIds;\n        if (!resourceIds.length) {\n            return [''];\n        }\n        return resourceIds;\n    };\n    return ResourceSplitter;\n}(Splitter));\n\nfunction isPropsValidWithResources(props, calendar) {\n    var splitter = new ResourceSplitter();\n    var sets = splitter.splitProps(__assign({}, props, { resourceStore: calendar.state.resourceStore }));\n    for (var resourceId in sets) {\n        var props_1 = sets[resourceId];\n        // merge in event data from the non-resource segment\n        if (resourceId && sets['']) { // current segment is not the non-resource one, and there IS a non-resource one\n            props_1 = __assign({}, props_1, { eventStore: mergeEventStores(sets[''].eventStore, props_1.eventStore), eventUiBases: __assign({}, sets[''].eventUiBases, props_1.eventUiBases) });\n        }\n        if (!isPropsValid(props_1, calendar, { resourceId: resourceId }, filterConfig.bind(null, resourceId))) {\n            return false;\n        }\n    }\n    return true;\n}\nfunction filterConfig(resourceId, config) {\n    return __assign({}, config, { constraints: filterConstraints(resourceId, config.constraints) });\n}\nfunction filterConstraints(resourceId, constraints) {\n    return constraints.map(function (constraint) {\n        var defs = constraint.defs;\n        if (defs) { // we are dealing with an EventStore\n            // if any of the events define constraints to resources that are NOT this resource,\n            // then this resource is unconditionally prohibited, which is what a `false` value does.\n            for (var defId in defs) {\n                var resourceIds = defs[defId].resourceIds;\n                if (resourceIds.length && resourceIds.indexOf(resourceId) === -1) { // TODO: use a hash?!!! (for other reasons too)\n                    return false;\n                }\n            }\n        }\n        return constraint;\n    });\n}\n\nfunction transformExternalDef(dateSpan) {\n    return dateSpan.resourceId ?\n        { resourceId: dateSpan.resourceId } :\n        {};\n}\n\nfunction transformEventResizeJoin(hit0, hit1) {\n    var component = hit0.component;\n    if (component.allowAcrossResources === false &&\n        hit0.dateSpan.resourceId !== hit1.dateSpan.resourceId) {\n        return false;\n    }\n}\n\nEventApi.prototype.getResources = function () {\n    var calendar = this._calendar;\n    return this._def.resourceIds.map(function (resourceId) {\n        return calendar.getResourceById(resourceId);\n    });\n};\nEventApi.prototype.setResources = function (resources) {\n    var resourceIds = [];\n    // massage resources -> resourceIds\n    for (var _i = 0, resources_1 = resources; _i < resources_1.length; _i++) {\n        var resource = resources_1[_i];\n        var resourceId = null;\n        if (typeof resource === 'string') {\n            resourceId = resource;\n        }\n        else if (typeof resource === 'number') {\n            resourceId = String(resource);\n        }\n        else if (resource instanceof ResourceApi) {\n            resourceId = resource.id; // guaranteed to always have an ID. hmmm\n        }\n        else {\n            console.warn('unknown resource type: ' + resource);\n        }\n        if (resourceId) {\n            resourceIds.push(resourceId);\n        }\n    }\n    this.mutate({\n        standardProps: {\n            resourceIds: resourceIds\n        }\n    });\n};\n\nvar RELEASE_DATE = '2020-02-12'; // for Scheduler\nvar UPGRADE_WINDOW = 365 + 7; // days. 1 week leeway, for tz shift reasons too\nvar LICENSE_INFO_URL = 'http://fullcalendar.io/scheduler/license/';\nvar PRESET_LICENSE_KEYS = [\n    'GPL-My-Project-Is-Open-Source',\n    'CC-Attribution-NonCommercial-NoDerivatives'\n];\nvar CSS = {\n    position: 'absolute',\n    'z-index': 99999,\n    bottom: '1px',\n    left: '1px',\n    background: '#eee',\n    'border-color': '#ddd',\n    'border-style': 'solid',\n    'border-width': '1px 1px 0 0',\n    padding: '2px 4px',\n    'font-size': '12px',\n    'border-top-right-radius': '3px'\n};\nfunction injectLicenseWarning(containerEl, calendar) {\n    var key = calendar.opt('schedulerLicenseKey');\n    if (!isImmuneUrl(window.location.href) && !isValidKey(key)) {\n        appendToElement(containerEl, '<div class=\"fc-license-message\" style=\"' + htmlEscape(cssToStr(CSS)) + '\">' +\n            'Please use a valid license key. <a href=\"' + LICENSE_INFO_URL + '\">More Info</a>' +\n            '</div>');\n    }\n}\n/*\nThis decryption is not meant to be bulletproof. Just a way to remind about an upgrade.\n*/\nfunction isValidKey(key) {\n    if (PRESET_LICENSE_KEYS.indexOf(key) !== -1) {\n        return true;\n    }\n    var parts = (key || '').match(/^(\\d+)\\-fcs\\-(\\d+)$/);\n    if (parts && (parts[1].length === 10)) {\n        var purchaseDate = new Date(parseInt(parts[2], 10) * 1000);\n        var releaseDate = new Date(config.mockSchedulerReleaseDate || RELEASE_DATE);\n        if (isValidDate(releaseDate)) { // token won't be replaced in dev mode\n            var minPurchaseDate = addDays(releaseDate, -UPGRADE_WINDOW);\n            if (minPurchaseDate < purchaseDate) {\n                return true;\n            }\n        }\n    }\n    return false;\n}\nfunction isImmuneUrl(url) {\n    return /\\w+\\:\\/\\/fullcalendar\\.io\\/|\\/examples\\/[\\w-]+\\.html$/.test(url);\n}\n\nvar optionChangeHandlers = {\n    resources: handleResources\n};\nfunction handleResources(newSourceInput, calendar, deepEqual) {\n    var oldSourceInput = calendar.state.resourceSource._raw;\n    if (!deepEqual(oldSourceInput, newSourceInput)) {\n        calendar.dispatch({\n            type: 'RESET_RESOURCE_SOURCE',\n            resourceSourceInput: newSourceInput\n        });\n    }\n}\n\nregisterResourceSourceDef({\n    ignoreRange: true,\n    parseMeta: function (raw) {\n        if (Array.isArray(raw)) {\n            return raw;\n        }\n        else if (Array.isArray(raw.resources)) {\n            return raw.resources;\n        }\n        return null;\n    },\n    fetch: function (arg, successCallback) {\n        successCallback({\n            rawResources: arg.resourceSource.meta\n        });\n    }\n});\n\nregisterResourceSourceDef({\n    parseMeta: function (raw) {\n        if (typeof raw === 'function') {\n            return raw;\n        }\n        else if (typeof raw.resources === 'function') {\n            return raw.resources;\n        }\n        return null;\n    },\n    fetch: function (arg, success, failure) {\n        var dateEnv = arg.calendar.dateEnv;\n        var func = arg.resourceSource.meta;\n        var publicArg = {};\n        if (arg.range) {\n            publicArg = {\n                start: dateEnv.toDate(arg.range.start),\n                end: dateEnv.toDate(arg.range.end),\n                startStr: dateEnv.formatIso(arg.range.start),\n                endStr: dateEnv.formatIso(arg.range.end),\n                timeZone: dateEnv.timeZone\n            };\n        }\n        // TODO: make more dry with EventSourceFunc\n        // TODO: accept a response?\n        unpromisify(func.bind(null, publicArg), function (rawResources) {\n            success({ rawResources: rawResources }); // needs an object response\n        }, failure // send errorObj directly to failure callback\n        );\n    }\n});\n\nregisterResourceSourceDef({\n    parseMeta: function (raw) {\n        if (typeof raw === 'string') {\n            raw = { url: raw };\n        }\n        else if (!raw || typeof raw !== 'object' || !raw.url) {\n            return null;\n        }\n        return {\n            url: raw.url,\n            method: (raw.method || 'GET').toUpperCase(),\n            extraParams: raw.extraParams\n        };\n    },\n    fetch: function (arg, successCallback, failureCallback) {\n        var meta = arg.resourceSource.meta;\n        var requestParams = buildRequestParams(meta, arg.range, arg.calendar);\n        requestJson(meta.method, meta.url, requestParams, function (rawResources, xhr) {\n            successCallback({ rawResources: rawResources, xhr: xhr });\n        }, function (message, xhr) {\n            failureCallback({ message: message, xhr: xhr });\n        });\n    }\n});\n// TODO: somehow consolidate with event json feed\nfunction buildRequestParams(meta, range, calendar) {\n    var dateEnv = calendar.dateEnv;\n    var startParam;\n    var endParam;\n    var timeZoneParam;\n    var customRequestParams;\n    var params = {};\n    if (range) {\n        // startParam = meta.startParam\n        // if (startParam == null) {\n        startParam = calendar.opt('startParam');\n        // }\n        // endParam = meta.endParam\n        // if (endParam == null) {\n        endParam = calendar.opt('endParam');\n        // }\n        // timeZoneParam = meta.timeZoneParam\n        // if (timeZoneParam == null) {\n        timeZoneParam = calendar.opt('timeZoneParam');\n        // }\n        params[startParam] = dateEnv.formatIso(range.start);\n        params[endParam] = dateEnv.formatIso(range.end);\n        if (dateEnv.timeZone !== 'local') {\n            params[timeZoneParam] = dateEnv.timeZone;\n        }\n    }\n    // retrieve any outbound GET/POST data from the options\n    if (typeof meta.extraParams === 'function') {\n        // supplied as a function that returns a key/value object\n        customRequestParams = meta.extraParams();\n    }\n    else {\n        // probably supplied as a straight key/value object\n        customRequestParams = meta.extraParams || {};\n    }\n    __assign(params, customRequestParams);\n    return params;\n}\n\nfunction buildResourceTextFunc(resourceTextSetting, calendar) {\n    if (typeof resourceTextSetting === 'function') {\n        return function (resource) {\n            return resourceTextSetting(new ResourceApi(calendar, resource));\n        };\n    }\n    else {\n        return function (resource) {\n            return resource.title || getPublicId(resource.id);\n        };\n    }\n}\n\nvar ResourceDayHeader = /** @class */ (function (_super) {\n    __extends(ResourceDayHeader, _super);\n    function ResourceDayHeader(parentEl) {\n        var _this = _super.call(this) || this;\n        _this.processOptions = memoize(_this._processOptions);\n        _this.parentEl = parentEl;\n        return _this;\n    }\n    ResourceDayHeader.prototype._processOptions = function (options, calendar) {\n        this.datesAboveResources = options.datesAboveResources;\n        this.resourceTextFunc = buildResourceTextFunc(options.resourceText, calendar);\n    };\n    ResourceDayHeader.prototype.render = function (props, context) {\n        var options = context.options, calendar = context.calendar, theme = context.theme;\n        this.processOptions(options, calendar);\n        this.parentEl.innerHTML = ''; // because might be nbsp\n        this.parentEl.appendChild(this.el = htmlToElement('<div class=\"fc-row ' + theme.getClass('headerRow') + '\">' +\n            '<table class=\"' + theme.getClass('tableGrid') + '\">' +\n            '<thead></thead>' +\n            '</table>' +\n            '</div>'));\n        this.thead = this.el.querySelector('thead');\n        var html;\n        this.dateFormat = createFormatter(options.columnHeaderFormat ||\n            computeFallbackHeaderFormat(props.datesRepDistinctDays, props.dates.length));\n        if (props.dates.length === 1) {\n            html = this.renderResourceRow(props.resources);\n        }\n        else {\n            if (this.datesAboveResources) {\n                html = this.renderDayAndResourceRows(props.dates, props.resources);\n            }\n            else {\n                html = this.renderResourceAndDayRows(props.resources, props.dates);\n            }\n        }\n        this.thead.innerHTML = html;\n        this.processResourceEls(props.resources);\n    };\n    ResourceDayHeader.prototype.destroy = function () {\n        removeElement(this.el);\n    };\n    ResourceDayHeader.prototype.renderResourceRow = function (resources) {\n        var _this = this;\n        var cellHtmls = resources.map(function (resource) {\n            return _this.renderResourceCell(resource, 1);\n        });\n        return this.buildTr(cellHtmls);\n    };\n    ResourceDayHeader.prototype.renderDayAndResourceRows = function (dates, resources) {\n        var dateHtmls = [];\n        var resourceHtmls = [];\n        for (var _i = 0, dates_1 = dates; _i < dates_1.length; _i++) {\n            var date = dates_1[_i];\n            dateHtmls.push(this.renderDateCell(date, resources.length));\n            for (var _a = 0, resources_1 = resources; _a < resources_1.length; _a++) {\n                var resource = resources_1[_a];\n                resourceHtmls.push(this.renderResourceCell(resource, 1, date));\n            }\n        }\n        return this.buildTr(dateHtmls) +\n            this.buildTr(resourceHtmls);\n    };\n    ResourceDayHeader.prototype.renderResourceAndDayRows = function (resources, dates) {\n        var resourceHtmls = [];\n        var dateHtmls = [];\n        for (var _i = 0, resources_2 = resources; _i < resources_2.length; _i++) {\n            var resource = resources_2[_i];\n            resourceHtmls.push(this.renderResourceCell(resource, dates.length));\n            for (var _a = 0, dates_2 = dates; _a < dates_2.length; _a++) {\n                var date = dates_2[_a];\n                dateHtmls.push(this.renderDateCell(date, 1, resource));\n            }\n        }\n        return this.buildTr(resourceHtmls) +\n            this.buildTr(dateHtmls);\n    };\n    // Cell Rendering Utils\n    // ----------------------------------------------------------------------------------------------\n    // a cell with the resource name. might be associated with a specific day\n    ResourceDayHeader.prototype.renderResourceCell = function (resource, colspan, date) {\n        var dateEnv = this.context.dateEnv;\n        return '<th class=\"fc-resource-cell\"' +\n            ' data-resource-id=\"' + resource.id + '\"' +\n            (date ?\n                ' data-date=\"' + dateEnv.formatIso(date, { omitTime: true }) + '\"' :\n                '') +\n            (colspan > 1 ?\n                ' colspan=\"' + colspan + '\"' :\n                '') +\n            '>' +\n            htmlEscape(this.resourceTextFunc(resource)) +\n            '</th>';\n    };\n    // a cell with date text. might have a resource associated with it\n    ResourceDayHeader.prototype.renderDateCell = function (date, colspan, resource) {\n        var props = this.props;\n        return renderDateCell(date, props.dateProfile, props.datesRepDistinctDays, props.dates.length * props.resources.length, this.dateFormat, this.context, colspan, resource ? 'data-resource-id=\"' + resource.id + '\"' : '');\n    };\n    ResourceDayHeader.prototype.buildTr = function (cellHtmls) {\n        if (!cellHtmls.length) {\n            cellHtmls = ['<td>&nbsp;</td>'];\n        }\n        if (this.props.renderIntroHtml) {\n            cellHtmls = [this.props.renderIntroHtml()].concat(cellHtmls);\n        }\n        if (this.context.isRtl) {\n            cellHtmls.reverse();\n        }\n        return '<tr>' +\n            cellHtmls.join('') +\n            '</tr>';\n    };\n    // Post-rendering\n    // ----------------------------------------------------------------------------------------------\n    // given a container with already rendered resource cells\n    ResourceDayHeader.prototype.processResourceEls = function (resources) {\n        var _a = this.context, calendar = _a.calendar, isRtl = _a.isRtl, view = _a.view;\n        findElements(this.thead, '.fc-resource-cell').forEach(function (node, col) {\n            col = col % resources.length;\n            if (isRtl) {\n                col = resources.length - 1 - col;\n            }\n            var resource = resources[col];\n            calendar.publiclyTrigger('resourceRender', [\n                {\n                    resource: new ResourceApi(calendar, resource),\n                    el: node,\n                    view: view\n                }\n            ]);\n        });\n    };\n    return ResourceDayHeader;\n}(Component));\n\nvar AbstractResourceDayTable = /** @class */ (function () {\n    function AbstractResourceDayTable(dayTable, resources) {\n        this.dayTable = dayTable;\n        this.resources = resources;\n        this.resourceIndex = new ResourceIndex(resources);\n        this.rowCnt = dayTable.rowCnt;\n        this.colCnt = dayTable.colCnt * resources.length;\n        this.cells = this.buildCells();\n    }\n    AbstractResourceDayTable.prototype.buildCells = function () {\n        var _a = this, rowCnt = _a.rowCnt, dayTable = _a.dayTable, resources = _a.resources;\n        var rows = [];\n        for (var row = 0; row < rowCnt; row++) {\n            var rowCells = [];\n            for (var dateCol = 0; dateCol < dayTable.colCnt; dateCol++) {\n                for (var resourceCol = 0; resourceCol < resources.length; resourceCol++) {\n                    var resource = resources[resourceCol];\n                    var htmlAttrs = 'data-resource-id=\"' + resource.id + '\"';\n                    rowCells[this.computeCol(dateCol, resourceCol)] = {\n                        date: dayTable.cells[row][dateCol].date,\n                        resource: resource,\n                        htmlAttrs: htmlAttrs\n                    };\n                }\n            }\n            rows.push(rowCells);\n        }\n        return rows;\n    };\n    return AbstractResourceDayTable;\n}());\n/*\nresources over dates\n*/\nvar ResourceDayTable = /** @class */ (function (_super) {\n    __extends(ResourceDayTable, _super);\n    function ResourceDayTable() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ResourceDayTable.prototype.computeCol = function (dateI, resourceI) {\n        return resourceI * this.dayTable.colCnt + dateI;\n    };\n    /*\n    all date ranges are intact\n    */\n    ResourceDayTable.prototype.computeColRanges = function (dateStartI, dateEndI, resourceI) {\n        return [\n            {\n                firstCol: this.computeCol(dateStartI, resourceI),\n                lastCol: this.computeCol(dateEndI, resourceI),\n                isStart: true,\n                isEnd: true\n            }\n        ];\n    };\n    return ResourceDayTable;\n}(AbstractResourceDayTable));\n/*\ndates over resources\n*/\nvar DayResourceTable = /** @class */ (function (_super) {\n    __extends(DayResourceTable, _super);\n    function DayResourceTable() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    DayResourceTable.prototype.computeCol = function (dateI, resourceI) {\n        return dateI * this.resources.length + resourceI;\n    };\n    /*\n    every single day is broken up\n    */\n    DayResourceTable.prototype.computeColRanges = function (dateStartI, dateEndI, resourceI) {\n        var segs = [];\n        for (var i = dateStartI; i <= dateEndI; i++) {\n            var col = this.computeCol(i, resourceI);\n            segs.push({\n                firstCol: col,\n                lastCol: col,\n                isStart: i === dateStartI,\n                isEnd: i === dateEndI\n            });\n        }\n        return segs;\n    };\n    return DayResourceTable;\n}(AbstractResourceDayTable));\nvar ResourceIndex = /** @class */ (function () {\n    function ResourceIndex(resources) {\n        var indicesById = {};\n        var ids = [];\n        for (var i = 0; i < resources.length; i++) {\n            var id = resources[i].id;\n            ids.push(id);\n            indicesById[id] = i;\n        }\n        this.ids = ids;\n        this.indicesById = indicesById;\n        this.length = resources.length;\n    }\n    return ResourceIndex;\n}());\n/*\nTODO: just use ResourceHash somehow? could then use the generic ResourceSplitter\n*/\nvar VResourceSplitter = /** @class */ (function (_super) {\n    __extends(VResourceSplitter, _super);\n    function VResourceSplitter() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    VResourceSplitter.prototype.getKeyInfo = function (props) {\n        var resourceDayTable = props.resourceDayTable;\n        var hash = mapHash(resourceDayTable.resourceIndex.indicesById, function (i) {\n            return resourceDayTable.resources[i]; // has `ui` AND `businessHours` keys!\n        }); // :(\n        hash[''] = {};\n        return hash;\n    };\n    VResourceSplitter.prototype.getKeysForDateSpan = function (dateSpan) {\n        return [dateSpan.resourceId || ''];\n    };\n    VResourceSplitter.prototype.getKeysForEventDef = function (eventDef) {\n        var resourceIds = eventDef.resourceIds;\n        if (!resourceIds.length) {\n            return [''];\n        }\n        return resourceIds;\n    };\n    return VResourceSplitter;\n}(Splitter));\n// joiner\nvar NO_SEGS = []; // for memoizing\nvar VResourceJoiner = /** @class */ (function () {\n    function VResourceJoiner() {\n        this.joinDateSelection = memoize(this.joinSegs);\n        this.joinBusinessHours = memoize(this.joinSegs);\n        this.joinFgEvents = memoize(this.joinSegs);\n        this.joinBgEvents = memoize(this.joinSegs);\n        this.joinEventDrags = memoize(this.joinInteractions);\n        this.joinEventResizes = memoize(this.joinInteractions);\n    }\n    /*\n    propSets also has a '' key for things with no resource\n    */\n    VResourceJoiner.prototype.joinProps = function (propSets, resourceDayTable) {\n        var dateSelectionSets = [];\n        var businessHoursSets = [];\n        var fgEventSets = [];\n        var bgEventSets = [];\n        var eventDrags = [];\n        var eventResizes = [];\n        var eventSelection = '';\n        var keys = resourceDayTable.resourceIndex.ids.concat(['']); // add in the all-resource key\n        for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n            var key = keys_1[_i];\n            var props = propSets[key];\n            dateSelectionSets.push(props.dateSelectionSegs);\n            businessHoursSets.push(key ? props.businessHourSegs : NO_SEGS); // don't include redundant all-resource businesshours\n            fgEventSets.push(key ? props.fgEventSegs : NO_SEGS); // don't include fg all-resource segs\n            bgEventSets.push(props.bgEventSegs);\n            eventDrags.push(props.eventDrag);\n            eventResizes.push(props.eventResize);\n            eventSelection = eventSelection || props.eventSelection;\n        }\n        return {\n            dateSelectionSegs: this.joinDateSelection.apply(this, [resourceDayTable].concat(dateSelectionSets)),\n            businessHourSegs: this.joinBusinessHours.apply(this, [resourceDayTable].concat(businessHoursSets)),\n            fgEventSegs: this.joinFgEvents.apply(this, [resourceDayTable].concat(fgEventSets)),\n            bgEventSegs: this.joinBgEvents.apply(this, [resourceDayTable].concat(bgEventSets)),\n            eventDrag: this.joinEventDrags.apply(this, [resourceDayTable].concat(eventDrags)),\n            eventResize: this.joinEventResizes.apply(this, [resourceDayTable].concat(eventResizes)),\n            eventSelection: eventSelection\n        };\n    };\n    VResourceJoiner.prototype.joinSegs = function (resourceDayTable) {\n        var segGroups = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            segGroups[_i - 1] = arguments[_i];\n        }\n        var resourceCnt = resourceDayTable.resources.length;\n        var transformedSegs = [];\n        for (var i = 0; i < resourceCnt; i++) {\n            for (var _a = 0, _b = segGroups[i]; _a < _b.length; _a++) {\n                var seg = _b[_a];\n                transformedSegs.push.apply(transformedSegs, this.transformSeg(seg, resourceDayTable, i));\n            }\n            for (var _c = 0, _d = segGroups[resourceCnt]; _c < _d.length; _c++) { // one beyond. the all-resource\n                var seg = _d[_c];\n                transformedSegs.push.apply(// one beyond. the all-resource\n                transformedSegs, this.transformSeg(seg, resourceDayTable, i));\n            }\n        }\n        return transformedSegs;\n    };\n    /*\n    for expanding non-resource segs to all resources.\n    only for public use.\n    no memoizing.\n    */\n    VResourceJoiner.prototype.expandSegs = function (resourceDayTable, segs) {\n        var resourceCnt = resourceDayTable.resources.length;\n        var transformedSegs = [];\n        for (var i = 0; i < resourceCnt; i++) {\n            for (var _i = 0, segs_1 = segs; _i < segs_1.length; _i++) {\n                var seg = segs_1[_i];\n                transformedSegs.push.apply(transformedSegs, this.transformSeg(seg, resourceDayTable, i));\n            }\n        }\n        return transformedSegs;\n    };\n    VResourceJoiner.prototype.joinInteractions = function (resourceDayTable) {\n        var interactions = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            interactions[_i - 1] = arguments[_i];\n        }\n        var resourceCnt = resourceDayTable.resources.length;\n        var affectedInstances = {};\n        var transformedSegs = [];\n        var isEvent = false;\n        var sourceSeg = null;\n        for (var i = 0; i < resourceCnt; i++) {\n            var interaction = interactions[i];\n            if (interaction) {\n                for (var _a = 0, _b = interaction.segs; _a < _b.length; _a++) {\n                    var seg = _b[_a];\n                    transformedSegs.push.apply(transformedSegs, this.transformSeg(seg, resourceDayTable, i) // TODO: templateify Interaction::segs\n                    );\n                }\n                __assign(affectedInstances, interaction.affectedInstances);\n                isEvent = isEvent || interaction.isEvent;\n                sourceSeg = sourceSeg || interaction.sourceSeg;\n            }\n            if (interactions[resourceCnt]) { // one beyond. the all-resource\n                for (var _c = 0, _d = interactions[resourceCnt].segs; _c < _d.length; _c++) {\n                    var seg = _d[_c];\n                    transformedSegs.push.apply(transformedSegs, this.transformSeg(seg, resourceDayTable, i) // TODO: templateify Interaction::segs\n                    );\n                }\n            }\n        }\n        return {\n            affectedInstances: affectedInstances,\n            segs: transformedSegs,\n            isEvent: isEvent,\n            sourceSeg: sourceSeg\n        };\n    };\n    return VResourceJoiner;\n}());\n\n/*\ndoesn't accept grouping\n*/\nfunction flattenResources(resourceStore, orderSpecs) {\n    return buildRowNodes(resourceStore, [], orderSpecs, false, {}, true)\n        .map(function (node) {\n        return node.resource;\n    });\n}\nfunction buildRowNodes(resourceStore, groupSpecs, orderSpecs, isVGrouping, expansions, expansionDefault) {\n    var complexNodes = buildHierarchy(resourceStore, isVGrouping ? -1 : 1, groupSpecs, orderSpecs);\n    var flatNodes = [];\n    flattenNodes(complexNodes, flatNodes, isVGrouping, [], 0, expansions, expansionDefault);\n    return flatNodes;\n}\nfunction flattenNodes(complexNodes, res, isVGrouping, rowSpans, depth, expansions, expansionDefault) {\n    for (var i = 0; i < complexNodes.length; i++) {\n        var complexNode = complexNodes[i];\n        var group = complexNode.group;\n        if (group) {\n            if (isVGrouping) {\n                var firstRowIndex = res.length;\n                var rowSpanIndex = rowSpans.length;\n                flattenNodes(complexNode.children, res, isVGrouping, rowSpans.concat(0), depth, expansions, expansionDefault);\n                if (firstRowIndex < res.length) {\n                    var firstRow = res[firstRowIndex];\n                    var firstRowSpans = firstRow.rowSpans = firstRow.rowSpans.slice();\n                    firstRowSpans[rowSpanIndex] = res.length - firstRowIndex;\n                }\n            }\n            else {\n                var id = group.spec.field + ':' + group.value;\n                var isExpanded = expansions[id] != null ? expansions[id] : expansionDefault;\n                res.push({ id: id, group: group, isExpanded: isExpanded });\n                if (isExpanded) {\n                    flattenNodes(complexNode.children, res, isVGrouping, rowSpans, depth + 1, expansions, expansionDefault);\n                }\n            }\n        }\n        else if (complexNode.resource) {\n            var id = complexNode.resource.id;\n            var isExpanded = expansions[id] != null ? expansions[id] : expansionDefault;\n            res.push({\n                id: id,\n                rowSpans: rowSpans,\n                depth: depth,\n                isExpanded: isExpanded,\n                hasChildren: Boolean(complexNode.children.length),\n                resource: complexNode.resource,\n                resourceFields: complexNode.resourceFields\n            });\n            if (isExpanded) {\n                flattenNodes(complexNode.children, res, isVGrouping, rowSpans, depth + 1, expansions, expansionDefault);\n            }\n        }\n    }\n}\nfunction buildHierarchy(resourceStore, maxDepth, groupSpecs, orderSpecs) {\n    var resourceNodes = buildResourceNodes(resourceStore, orderSpecs);\n    var builtNodes = [];\n    for (var resourceId in resourceNodes) {\n        var resourceNode = resourceNodes[resourceId];\n        if (!resourceNode.resource.parentId) {\n            insertResourceNode(resourceNode, builtNodes, groupSpecs, 0, maxDepth, orderSpecs);\n        }\n    }\n    return builtNodes;\n}\nfunction buildResourceNodes(resourceStore, orderSpecs) {\n    var nodeHash = {};\n    for (var resourceId in resourceStore) {\n        var resource = resourceStore[resourceId];\n        nodeHash[resourceId] = {\n            resource: resource,\n            resourceFields: buildResourceFields(resource),\n            children: []\n        };\n    }\n    for (var resourceId in resourceStore) {\n        var resource = resourceStore[resourceId];\n        if (resource.parentId) {\n            var parentNode = nodeHash[resource.parentId];\n            if (parentNode) {\n                insertResourceNodeInSiblings(nodeHash[resourceId], parentNode.children, orderSpecs);\n            }\n        }\n    }\n    return nodeHash;\n}\nfunction insertResourceNode(resourceNode, nodes, groupSpecs, depth, maxDepth, orderSpecs) {\n    if (groupSpecs.length && (maxDepth === -1 || depth <= maxDepth)) {\n        var groupNode = ensureGroupNodes(resourceNode, nodes, groupSpecs[0]);\n        insertResourceNode(resourceNode, groupNode.children, groupSpecs.slice(1), depth + 1, maxDepth, orderSpecs);\n    }\n    else {\n        insertResourceNodeInSiblings(resourceNode, nodes, orderSpecs);\n    }\n}\nfunction ensureGroupNodes(resourceNode, nodes, groupSpec) {\n    var groupValue = resourceNode.resourceFields[groupSpec.field];\n    var groupNode;\n    var newGroupIndex;\n    // find an existing group that matches, or determine the position for a new group\n    if (groupSpec.order) {\n        for (newGroupIndex = 0; newGroupIndex < nodes.length; newGroupIndex++) {\n            var node = nodes[newGroupIndex];\n            if (node.group) {\n                var cmp = flexibleCompare(groupValue, node.group.value) * groupSpec.order;\n                if (cmp === 0) {\n                    groupNode = node;\n                    break;\n                }\n                else if (cmp < 0) {\n                    break;\n                }\n            }\n        }\n    }\n    else { // the groups are unordered\n        for (newGroupIndex = 0; newGroupIndex < nodes.length; newGroupIndex++) {\n            var node = nodes[newGroupIndex];\n            if (node.group && groupValue === node.group.value) {\n                groupNode = node;\n                break;\n            }\n        }\n    }\n    if (!groupNode) {\n        groupNode = {\n            group: {\n                value: groupValue,\n                spec: groupSpec\n            },\n            children: []\n        };\n        nodes.splice(newGroupIndex, 0, groupNode);\n    }\n    return groupNode;\n}\nfunction insertResourceNodeInSiblings(resourceNode, siblings, orderSpecs) {\n    var i;\n    for (i = 0; i < siblings.length; i++) {\n        var cmp = compareByFieldSpecs(siblings[i].resourceFields, resourceNode.resourceFields, orderSpecs);\n        if (cmp > 0) { // went 1 past. insert at i\n            break;\n        }\n    }\n    siblings.splice(i, 0, resourceNode);\n}\nfunction buildResourceFields(resource) {\n    var obj = __assign({}, resource.extendedProps, resource.ui, resource);\n    delete obj.ui;\n    delete obj.extendedProps;\n    return obj;\n}\nfunction isGroupsEqual(group0, group1) {\n    return group0.spec === group1.spec && group0.value === group1.value;\n}\n\nvar main = createPlugin({\n    reducers: [resourcesReducers],\n    eventDefParsers: [parseEventDef],\n    isDraggableTransformers: [transformIsDraggable],\n    eventDragMutationMassagers: [massageEventDragMutation],\n    eventDefMutationAppliers: [applyEventDefMutation],\n    dateSelectionTransformers: [transformDateSelectionJoin],\n    datePointTransforms: [transformDatePoint],\n    dateSpanTransforms: [transformDateSpan],\n    viewPropsTransformers: [ResourceDataAdder, ResourceEventConfigAdder],\n    isPropsValid: isPropsValidWithResources,\n    externalDefTransforms: [transformExternalDef],\n    eventResizeJoinTransforms: [transformEventResizeJoin],\n    viewContainerModifiers: [injectLicenseWarning],\n    eventDropTransformers: [transformEventDrop],\n    optionChangeHandlers: optionChangeHandlers\n});\n\nexport default main;\nexport { AbstractResourceDayTable, DayResourceTable, ResourceApi, ResourceDayHeader, ResourceDayTable, ResourceSplitter, VResourceJoiner, VResourceSplitter, buildResourceFields, buildResourceTextFunc, buildRowNodes, flattenResources, isGroupsEqual };\n"]},"metadata":{},"sourceType":"module"}